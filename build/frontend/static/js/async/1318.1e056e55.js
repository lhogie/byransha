"use strict";(self.webpackChunklogin_page=self.webpackChunklogin_page||[]).push([["1318"],{16095:function(e,l,n){n.d(l,{l:()=>eh});var a=n(85893),t=n(38655),i=n(11419),r=n(97454),s=n(9599),o=n(33991),d=n(61215),u=n(54757),c=n(77821),m=n(37745),v=n(21967),x=n(9e3),h=n(99469),f=n(93162),g=n(9673),p=n(89803),y=n(7409),j=n(99282),b=n(13400),Z=n(67294),C=n(93627),_=n(15858),w=n(32153),N=n(11731),S=n(81035),T=n(89717),z=n(6896);let I=Z.memo(e=>{let{show:l,selectedField:n,existingNodeList:t,loadingExistingNodes:i,onClose:r,onSelectNode:s}=e,[c,m]=(0,Z.useState)(""),v=(0,Z.useCallback)(e=>{m(e.target.value)},[]),x=(0,Z.useCallback)(()=>{r()},[r]),h=(0,Z.useMemo)(()=>t.filter(e=>e.name.toLowerCase().includes(c.toLowerCase())),[t,c]),f=(0,Z.useCallback)(e=>{s(e,n)},[s,n]);return(0,a.jsx)(_.Z,{open:l,onClose:x,"aria-labelledby":"existing-node-modal-title","aria-describedby":"existing-node-modal-description",children:(0,a.jsx)(o.Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:{xs:"95vw",sm:"90%",md:"80%"},maxWidth:{xs:"none",sm:600},maxHeight:"90vh",bgcolor:"background.paper",boxShadow:24,outline:"none"},children:(0,a.jsxs)(w.Z,{className:"existing-node-card",sx:{width:"100%",maxHeight:{xs:"85vh",sm:"80vh"},overflow:"auto",borderRadius:{xs:1,sm:2}},children:[(0,a.jsx)(N.Z,{title:"Select Existing Node",action:(0,a.jsx)(S.Z,{onClick:x,"aria-label":"close",children:(0,a.jsx)(C.Z,{})})}),(0,a.jsxs)(T.Z,{children:[(0,a.jsx)(z.Z,{fullWidth:!0,variant:"outlined",placeholder:"Search nodes...",value:c,onChange:v,sx:{mb:2}}),(0,a.jsx)(o.Z,{className:"node-list",sx:{maxHeight:"50vh",overflow:"auto"},children:i?(0,a.jsxs)(o.Z,{display:"flex",justifyContent:"center",p:2,children:[(0,a.jsx)(d.Z,{size:24})," ",(0,a.jsx)(u.Z,{sx:{ml:1},children:"Loading nodes..."})]}):(0,a.jsx)(b.Z,{spacing:1,children:h.map(e=>(0,a.jsx)(o.Z,{sx:{p:2,cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},onClick:()=>f(e),children:(0,a.jsx)(u.Z,{fontWeight:"bold",children:e.name})},e.id))})})]})]})})})});var A=n(98848),k=n(80770);let E=e=>{var{value:l,onFocus:n,onChange:t,error:i,helperText:r}=e,s=(0,A._)(e,["value","onFocus","onChange","error","helperText"]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.Z,(0,y._)({style:{marginLeft:20},color:l||"",onFocus:n,onChange:e=>{t(e.hex)}},s)),r&&(0,a.jsx)(u.Z,{color:i?"error":"textSecondary",variant:"caption",sx:{mt:1},children:r})]})};var L=n(93193),F=n(18865),D=n(41994),K=n(74542),V=n(43180),W=n(54649),q=n(45471);n(44493),n(83608),V.Tu.workerSrc=new URL(n(87663),n.b).toString();let R=e=>{var l,n,i,r,m;let{field:v,parentId:x}=e,{data:h,refetch:g}=(0,t.m_)("class_attribute_field",{node_id:v.id}),p=(0,t.uC)("set_value"),y=null==h||null==(m=h.data)||null==(r=m.results)||null==(i=r[0])||null==(n=i.result)||null==(l=n.data)?void 0:l.attributes,j=y?null==y?void 0:y.find(e=>(null==e?void 0:e.type)==="ByteNode"):null,Z=y?null==y?void 0:y.find(e=>(null==e?void 0:e.type)==="StringNode"):null,C=y?null==y?void 0:y.find(e=>(null==e?void 0:e.type)==="MimeTypeNode"):null;return(0,a.jsx)(o.Z,{sx:{mb:2},children:(0,a.jsxs)(b.Z,{spacing:2,children:[j&&Z&&C&&j.value&&Z.value&&C.value?(0,a.jsxs)(o.Z,{children:[(0,a.jsx)(u.Z,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:"Aper\xe7u du fichier"}),(0,a.jsx)(o.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2,border:1,borderColor:"grey.300",borderRadius:1,bgcolor:"grey.50",minHeight:200},children:"application/pdf"===C.value?(0,a.jsx)(W.Z,{file:"data:".concat(C.value,";base64,").concat(j.value),loading:(0,a.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,a.jsx)(d.Z,{size:40,sx:{mb:1}}),(0,a.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:"Chargement du PDF..."})]}),error:(0,a.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:2},children:[(0,a.jsx)(D.Z,{color:"error",sx:{fontSize:48,mb:1}}),(0,a.jsx)(u.Z,{variant:"caption",color:"error",children:"Aper\xe7u non disponible"})]}),children:(0,a.jsx)(q.Z,{pageNumber:1,width:200,renderTextLayer:!1,renderAnnotationLayer:!1})}):C.value.startsWith("image/")?(0,a.jsx)(o.Z,{component:"img",src:"data:".concat(C.value,";base64,").concat(j.value),alt:Z.value,sx:{maxHeight:180,maxWidth:"100%",objectFit:"contain",borderRadius:1}}):(0,a.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:3},children:[(0,a.jsx)(F.Z,{sx:{fontSize:48,color:"text.secondary",mb:1}}),(0,a.jsxs)(u.Z,{variant:"body2",color:"text.secondary",align:"center",children:['"',Z.value,'"']}),(0,a.jsx)(u.Z,{variant:"caption",color:"text.secondary",align:"center",children:"Le fichier ne peut pas \xeatre pr\xe9visualis\xe9"})]})}),(0,a.jsx)(u.Z,{variant:"body2",color:"text.primary",sx:{mt:1,fontWeight:"medium"},children:Z.value})]}):(0,a.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:4,border:2,borderColor:"grey.300",borderStyle:"dashed",borderRadius:2,bgcolor:"grey.50"},children:[(0,a.jsx)(L.Z,{sx:{fontSize:48,color:"text.secondary",mb:2}}),(0,a.jsx)(u.Z,{variant:"body1",color:"text.secondary",align:"center",children:"Aucun fichier t\xe9l\xe9charg\xe9"}),(0,a.jsx)(u.Z,{variant:"caption",color:"text.secondary",align:"center",children:"T\xe9l\xe9chargez un fichier pour commencer"})]}),(0,a.jsx)(K.Z,{}),(0,a.jsxs)(b.Z,{direction:"row",spacing:2,justifyContent:"flex-start",children:[j&&Z&&C&&j.value&&Z.value&&(0,a.jsx)(c.Z,{variant:"outlined",startIcon:(0,a.jsx)(s.Z,{}),onClick:()=>{(0,f.saveAs)("data:".concat(C.value,";base64,").concat(j.value),Z.value)},disabled:!(j&&C&&j.value&&Z&&Z.value),sx:{minWidth:140},children:"T\xe9l\xe9charger"}),(0,a.jsxs)(c.Z,{variant:"contained",component:"label",startIcon:(0,a.jsx)(L.Z,{}),sx:{minWidth:120},children:["T\xe9l\xe9charger un fichier",(0,a.jsx)("input",{type:"file",hidden:!0,onChange:e=>{let l=e.target.files[0];if(l){let e=new FileReader;e.onloadend=async()=>{if("string"==typeof e.result){var n;let a=null==(n=e.result)?void 0:n.split(",")[1];await Promise.all([p.mutateAsync({id:j.id,value:a,parentId:x}),p.mutateAsync({id:Z.id,value:l.name,parentId:x}),p.mutateAsync({id:C.id,value:l.type,parentId:x})]),await g()}},e.readAsDataURL(l)}else alert("Veuillez s\xe9lectionner un fichier."),e.target.value=null}})]})]})]})})};var Q=n(19298),P=n(92719),M=n(12550),O=n(73892),U=n(7942),H=n(24697),B=n(39380),$=n(89276);let G=e=>{var{fieldKey:l,value:n,onFocus:t,onChange:i}=e,r=(0,A._)(e,["fieldKey","value","onFocus","onChange"]);return(0,a.jsx)(B.Z,{control:(0,a.jsx)($.Z,(0,y._)({id:l,checked:!!n,onChange:e=>i(e.target.checked)},r)),label:""})};var X=n(85714),J=n(64578),Y=n(27484),ee=n.n(Y);let el=e=>{let l,n;var{fieldKey:t,value:i,onChange:r,error:s,helperText:o,field:d}=e,u=(0,A._)(e,["fieldKey","value","onChange","error","helperText","field"]);let[c,m]=(0,Z.useState)(i?ee()(i):null),[v,x]=(0,Z.useState)(!1);(0,Z.useEffect)(()=>{m(i?ee()(i):null)},[i]),(null==d?void 0:d.validations)&&(void 0!==d.validations.min&&(l=ee()(d.validations.min)),void 0!==d.validations.max&&(n=ee()(d.validations.max)));let h=s||v,f=v&&!o?"Date invalide":o;return(0,a.jsxs)(O.Z,{fullWidth:!0,error:h,children:[(0,a.jsx)(J.M,(0,j._)((0,y._)({value:c,onChange:(e,l)=>{m(e),x(null!==e&&!e.isValid()),(null===e||(null==e?void 0:e.isValid()))&&r(null==e?void 0:e.toISOString())},sx:{width:"100%"},minDate:l,maxDate:n},u),{slotProps:{textField:{size:"small",error:h}}})),f&&(0,a.jsx)(X.Z,{children:f})]})};var en=n(11786);let ea=e=>{var l,n,i,r,s,o,d,u,c,m,v,x,h,f,g,p,b,C,_,w,N,S,T,I,k,E,{field:L,fieldKey:F,value:D,defaultValue:K,onFocus:V,onChange:W,onFirstChange:q,error:R,helperText:Q,multiple:P=!1}=e,M=(0,A._)(e,["field","fieldKey","value","defaultValue","onFocus","onChange","onFirstChange","error","helperText","multiple"]);let U=null==(l=L.listNodeType)?void 0:l.split(".").pop(),H=L.choices||[],B=H.length>0,{data:$,isLoading:G,isError:J}=(0,t.m_)("class_attribute_field",{node_id:L.id});(0,Z.useEffect)(()=>{var e,l,n,a,t,i,r,s,o,d,u,c,m;B||G||J||(null==$||null==(i=$.data)||null==(t=i.results)||null==(a=t[0])||null==(n=a.result)||null==(l=n.data)||null==(e=l.attributes)?void 0:e.length)===0||q(null==$||null==(m=$.data)||null==(c=m.results)||null==(u=c[0])||null==(d=u.result)||null==(o=d.data)||null==(s=o.attributes)||null==(r=s.map(e=>({label:e.name.split(". ")[1],value:"STRING"===L.elementType?e.value:e.id})))?void 0:r[0])},[L.elementType,B,G,J,q,null==$||null==(d=$.data)||null==(o=d.results)||null==(s=o[0])||null==(r=s.result)||null==(i=r.data)||null==(n=i.attributes)?void 0:n.length,null==$||null==(h=$.data)||null==(x=h.results)||null==(v=x[0])||null==(m=v.result)||null==(c=m.data)||null==(u=c.attributes)?void 0:u.map]);let{data:Y,isLoading:ee,isError:el}=(0,t.m_)(B?void 0:"list_existing_node",{type:U});return(0,Z.useEffect)(()=>{var e,l,n,a,t,i,r,s,o;if(B&&!ee&&!el&&(null==Y||null==(t=Y.data)||null==(a=t.results)||null==(n=a[0])||null==(l=n.result)||null==(e=l.data)?void 0:e.length)!==0&&!P)if(K)if(2===K.split("@").length){let e=Number.parseInt(K.split("@")[1],10),l=null==Y||null==(o=Y.data)||null==(s=o.results)||null==(r=s[0])||null==(i=r.result)?void 0:i.data.find(l=>l.id===e);l?q({label:l.name,value:l.id}):q(void 0)}else q({label:K,value:K});else q(void 0)},[B,ee,el,K,null==Y||null==(b=Y.data)||null==(p=b.results)||null==(g=p[0])||null==(f=g.result)?void 0:f.data.find,null==Y||null==(S=Y.data)||null==(N=S.results)||null==(w=N[0])||null==(_=w.result)||null==(C=_.data)?void 0:C.length,P,q]),(0,a.jsxs)(O.Z,{fullWidth:!0,error:R,children:[(0,a.jsx)(en.Z,(0,y._)({disablePortal:!0,renderInput:e=>(0,a.jsx)(z.Z,(0,j._)((0,y._)({},e),{error:R})),options:B?H.map(e=>{var l;return{label:e,value:e,firstLetter:null==(l=e[0])?void 0:l.toUpperCase()}}):(null==Y||null==(E=Y.data)||null==(k=E.results)||null==(I=k[0])||null==(T=I.result)?void 0:T.data.map(e=>{var l;let n=null==(l=e.name[0])?void 0:l.toUpperCase();return{label:e.name,value:e.id,firstLetter:"France(FR)"===e.name?" ":/[0-9]/.test(n)?"0-9":n}}).sort((e,l)=>e.firstLetter!==l.firstLetter?e.firstLetter.localeCompare(l.firstLetter):e.label.localeCompare(l.label)))||[],groupBy:e=>e.firstLetter,getOptionKey:e=>{var l;return null!=(l=e.value)?l:""},getOptionLabel:e=>{var l;return null!=(l=e.label)?l:""},isOptionEqualToValue:(e,l)=>e.value===l.value,size:"small",id:F,value:D,onChange:(e,l)=>{W(l)},multiple:P},M)),Q&&(0,a.jsx)(X.Z,{children:Q})]})};var et=n(87884);let ei=e=>{let{option:l,fieldId:n}=e,[i,r]=(0,Z.useState)(l.value),s=(0,t.uC)("set_value"),o=(0,h.NL)(),d=(0,H.y1)(async e=>{if(!e)return console.warn("No field provided for saving changes");try{await U.ZP.promise(s.mutateAsync({id:e.id,value:i},{onSuccess:async()=>{await o.invalidateQueries({queryKey:["infinite","apiData","class_attribute_field",{node_id:Number.parseInt(n,10)}]}),await o.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:Number.parseInt(n,10)}]})}}),{loading:"Enregistrement de ".concat((0,p.rj)(e.name),"..."),success:"Changements enregistr\xe9s pour ".concat((0,p.rj)(e.name)),error:"Erreur lors de l'enregistrement des changements pour ".concat((0,p.rj)(e.name))})}catch(e){console.error("Error saving changes:",e)}},500,{maxWait:2e3});return(0,a.jsx)(B.Z,{label:l.name,control:(0,a.jsx)($.Z,{checked:i||!1,onChange:e=>{r(e.target.checked),d(l)}})})},er=e=>{var l,n,i,r,s,o;let{field:d,error:u,helperText:c}=e,{data:m}=(0,t.m_)("class_attribute_field",{node_id:d.id});return(0,a.jsxs)(O.Z,{fullWidth:!0,error:u,children:[(0,a.jsx)(et.Z,{row:!0,children:null==m||null==(o=m.data)||null==(s=o.results)||null==(r=s[0])||null==(i=r.result)||null==(n=i.data)||null==(l=n.attributes)?void 0:l.map((e,l)=>(0,a.jsx)(ei,{option:e,fieldId:d.id},l))}),c&&(0,a.jsx)(X.Z,{children:c})]})},es=e=>{var l,n,i,r,s,o,d,u,c,m,v,x,{field:h,fieldKey:f,value:g,onFocus:p,onChange:j,onFirstChange:b,error:C,helperText:_}=e,w=(0,A._)(e,["field","fieldKey","value","onFocus","onChange","onFirstChange","error","helperText"]);let{data:N,isLoading:S,isError:T}=(0,t.m_)("class_attribute_field",{node_id:h.id});return(0,Z.useEffect)(()=>{var e,l,n,a,t,i,r,s,o,d,u,c;S||T||(null==N||null==(i=N.data)||null==(t=i.results)||null==(a=t[0])||null==(n=a.result)||null==(l=n.data)||null==(e=l.attributes)?void 0:e.length)===0||b(null==N||null==(c=N.data)||null==(u=c.results)||null==(d=u[0])||null==(o=d.result)||null==(s=o.data)||null==(r=s.attributes)?void 0:r.map(e=>({firstLetter:e.name.split(". ")[1][0],label:e.name.split(". ")[1],value:e.id})))},[S,T,b,null==N||null==(o=N.data)||null==(s=o.results)||null==(r=s[0])||null==(i=r.result)||null==(n=i.data)||null==(l=n.attributes)?void 0:l.length,null==N||null==(x=N.data)||null==(v=x.results)||null==(m=v[0])||null==(c=m.result)||null==(u=c.data)||null==(d=u.attributes)?void 0:d.map]),(0,a.jsx)(ea,(0,y._)({field:h,fieldKey:f,value:g,onChange:j,onFirstChange:b,error:C,helperText:_,multiple:!0},w))};var eo=n(36762),ed=n(54791);let eu=e=>{var l,{field:n,fieldKey:t,value:i,defaultValue:r,onFocus:s,onChange:o,error:d,helperText:u,onFirstChange:c}=e,m=(0,A._)(e,["field","fieldKey","value","defaultValue","onFocus","onChange","error","helperText","onFirstChange"]);return(0,a.jsxs)(O.Z,{fullWidth:!0,error:d,children:[(0,a.jsx)(eo.Z,(0,j._)((0,y._)({row:!0,name:t,value:i||r,onChange:e=>o(e.target.value),onFocus:s},m),{children:null==(l=n.choices)?void 0:l.map((e,l)=>(0,a.jsx)(B.Z,{value:l,control:(0,a.jsx)(ed.Z,{}),label:e},l))})),u&&(0,a.jsx)(X.Z,{children:u})]})},ec=e=>{var{field:l,fieldKey:n,value:t,onFocus:i,onChange:r,error:s,helperText:o}=e,d=(0,A._)(e,["field","fieldKey","value","onFocus","onChange","error","helperText"]);let c={};return(l.validations&&("IntNode"===l.type&&void 0!==l.validations.min&&(c.min=l.validations.min),"IntNode"===l.type&&void 0!==l.validations.max&&(c.max=l.validations.max),l.validations.size&&(void 0!==l.validations.size.min&&(c.minLength=l.validations.size.min),void 0!==l.validations.size.max&&(c.maxLength=l.validations.size.max))),!1===l.canEdit)?(0,a.jsx)(u.Z,{variant:"body1",sx:{py:1},children:t||""}):(0,a.jsx)(z.Z,(0,y._)({fullWidth:!0,id:n,variant:"outlined",type:(e=>{switch(e){case"EmailNode":return"email";case"PhoneNumberNode":return"tel";case"IntNode":return"number";default:return"text"}})(l.type),value:t||"",onFocus:i,onChange:e=>r(e.target.value),error:s,helperText:o,inputProps:c},d))},em=Z.memo(e=>{let{field:l,fieldKey:n,isExpanded:i,onToggleField:r,onChangingForm:s,parentId:d,defaultValue:m=""}=e,{id:v,name:x,type:f,validations:g,isValid:y}=l,[j,b]=(0,Z.useState)(p.zS.includes(f)?"RADIO"===l.listType?l.value:[]:m),[C,_]=(0,Z.useState)(!1),[w,N]=(0,Z.useState)(""),T=(0,h.NL)(),z=(0,t.uC)("set_value"),I=(0,t.uC)("add_existing_node"),A=(0,t.uC)("remove_from_list"),k=(0,H.y1)(e=>{let l=(0,p.Qc)(f,e,g);return _(!l.isValid),N(l.message),l.isValid},300,{maxWait:1e3});(0,Z.useEffect)(()=>{k(j)},[j,k]);let L=(0,H.y1)(async e=>{if(!e)return console.warn("No field provided for saving changes");if(!k(j))return void"Invalid value for ".concat(e.name," (").concat(e.type,"): ").concat(j);try{await U.ZP.promise(z.mutateAsync({id:e.id,value:j,parentId:d},{onSuccess:async()=>{await T.invalidateQueries({queryKey:["infinite","apiData","class_attribute_field",{node_id:Number.parseInt(d,10)}]}),await T.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:Number.parseInt(d,10)}]})}}),{loading:"Enregistrement de ".concat((0,p.rj)(e.name),"..."),success:"Changements enregistr\xe9s pour ".concat((0,p.rj)(e.name)),error:"Erreur lors de l'enregistrement des changements pour ".concat((0,p.rj)(e.name))})}catch(e){console.error("Error saving changes:",e),_(!0),N("Error saving changes: ".concat(e.message))}},500,{maxWait:2e3}),F=(0,H.y1)(async function(e,l){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(!e)return console.warn("No field provided for saving changes");if(!k(l))return void"Invalid value for ".concat(e.name," (").concat(e.type,"): ").concat(l);try{await U.ZP.promise((n?I:A).mutateAsync({node_id:e.id,id:l},{onSuccess:async()=>{await T.invalidateQueries({queryKey:["infinite","apiData","class_attribute_field",{node_id:Number.parseInt(d,10)}]}),await T.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:Number.parseInt(d,10)}]})}}),{loading:"Enregistrement de ".concat((0,p.rj)(e.name),"..."),success:"Changements enregistr\xe9s pour ".concat((0,p.rj)(e.name)),error:"Erreur lors de l'enregistrement des changements pour ".concat((0,p.rj)(e.name))})}catch(e){console.error("Error saving changes:",e),_(!0),N("Error saving changes: ".concat(e.message))}}),D=(0,Z.useCallback)(function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let n=(0,p.Qc)(l.type,e,g);_(!n),n?N(""):N((0,p.e$)(l.type,e,g)),L(l),b(e)},[l,L,g]),K=(0,Z.useCallback)(e=>{let n=(0,p.Qc)(l.type,null==e?void 0:e.value,g);_(!n),n?N(""):N((0,p.e$)(l.type,null==e?void 0:e.value,g)),F(l,null==e?void 0:e.value),b(e)},[l,F,g]),V=(0,Z.useCallback)(e=>{b(e)},[]),W=(0,Z.useCallback)(e=>{if(!k(e))return;let n=j||[],a=e||[],t=a.filter(e=>!n.some(l=>l.value===e.value));t.length>0&&t.forEach(e=>{F(l,e.value)});let i=n.filter(e=>!a.some(l=>l.value===e.value));i.length>0&&i.forEach(e=>{F(l,e.value,!1)}),b(e)},[l,F,j,k]),q=(0,Z.useCallback)(e=>b(e),[]),B=(0,Z.useCallback)(()=>{s(x,v)},[s,x,v]),$=(0,Z.useCallback)(()=>{r(n,v)},[r,n,v]);return(0,Z.useEffect)(()=>()=>{L.flush()},[L]),(0,a.jsx)(o.Z,{className:"form-field-wrapper",sx:{p:1},children:(0,a.jsxs)(M.Z,{container:!0,className:"form-field",spacing:2,alignItems:"center",children:[(0,a.jsx)(M.Z,{size:{xs:12,sm:4},children:(0,a.jsxs)(O.Z,{component:"fieldset",sx:{display:"flex",flexDirection:"row"},children:[(0,a.jsx)(c.Z,{tabIndex:-1,variant:"text",color:"primary",onClick:B,title:n,sx:{textAlign:"left",justifyContent:"flex-start"},children:(0,a.jsx)(u.Z,{fontWeight:"medium",color:!1===y?"error":"primary",sx:{fontWeight:!1===y?"bold":"regular"},children:(0,p.rj)(x)})}),!(p.M1.includes(f)||p.zS.includes(f)&&"LIST"!==l.listType)&&(0,a.jsx)(o.Z,{className:"toggle-wrapper",textAlign:"right",children:(0,a.jsx)(S.Z,{onClick:$,size:"small",children:i?(0,a.jsx)(Q.Z,{}):(0,a.jsx)(P.Z,{})})})]})}),(0,a.jsxs)(M.Z,{size:{xs:12,sm:6},children:[p.zS.includes(f)&&"CHECKBOX"===l.listType&&(0,a.jsx)(er,{field:l,error:C,helperText:C?w:""}),p.KX.includes(f)&&(0,a.jsx)(ec,{field:l,fieldKey:n,value:j,onChange:D,size:"small",error:C,helperText:C?w:""}),p.pt.includes(f)&&(0,a.jsx)(el,{fieldKey:n,field:l,value:j,onChange:D,error:C,helperText:C?w:""}),p.qG.includes(f)&&(0,a.jsx)(G,{fieldKey:n,value:j,onChange:D}),p.yT.includes(f)&&(0,a.jsx)(R,{field:l,parentId:d}),p.zS.includes(f)&&"DROPDOWN"===l.listType&&(0,a.jsx)(ea,{field:l,fieldKey:n,value:null!=j?j:null,onChange:K,onFirstChange:V,defaultValue:m,error:C,helperText:C?w:""}),p.zS.includes(f)&&"MULTIDROPDOWN"===l.listType&&(0,a.jsx)(es,{field:l,fieldKey:n,value:null!=j?j:[],onChange:W,onFirstChange:q,error:C,helperText:C?w:""}),p.zS.includes(f)&&"RADIO"===l.listType&&(0,a.jsx)(eu,{field:l,fieldKey:n,value:j,onChange:D,onFirstChange:V,defaultValue:m,error:C,helperText:C?w:""}),p.pG.includes(f)&&(0,a.jsx)(E,{value:j,onChange:D,error:C,helperText:w})]})]})},n)},(e,l)=>e.fieldKey===l.fieldKey&&e.isExpanded===l.isExpanded&&e.onToggleField===l.onToggleField&&e.defaultValue===l.defaultValue),ev=e=>{let{parentId:l,fields:n,visited:t=new Set,expandedFields:i,toggleField:r,handleChangingForm:s,rootId:o}=e;return n&&Array.isArray(n)?n.map(e=>{let{id:n,name:d,type:c}=e;if(!d||"graph"===d)return null;let m=(0,p.Tl)(e.id,e.name);if(t.has(n))return(0,a.jsxs)(u.Z,{color:"error",children:["Circular reference detected for ",d]},"cycle-".concat(n));let v=i[m]||!1;return(0,a.jsxs)(Z.Fragment,{children:[(0,a.jsx)(em,{field:e,fieldKey:m,isExpanded:v,onToggleField:r,onChangingForm:s,defaultValue:e.value,parentId:l}),!(p.M1.includes(c)||p.zS.includes(c)&&"LIST"!==e.listType)&&(0,a.jsx)(ex,{fieldKey:m,field:e,rootId:o,isToggle:v})]},m)}):null},ex=Z.memo(e=>{let{field:l,rootId:n,isRoot:r=!1,isToggle:s=!1}=e,{data:d,isLoading:m,fetchNextPage:v,hasNextPage:x,isFetchingNextPage:f,error:C,isError:_}=(0,t.SF)("class_attribute_field",{node_id:"string"==typeof l.id?Number.parseInt(l.id,10):l.id},{enabled:s||r}),w=(0,g.s0)(),N=(0,h.NL)(),S=(0,t.uC)("jump"),T=(0,t.uC)("add_node"),z=(0,t.uC)("list_existing_node"),A=(0,t.uC)("add_existing_node"),[k,E]=(0,Z.useState)({}),[L,F]=(0,Z.useState)(!1),[D,K]=(0,Z.useState)([]),[V,W]=(0,Z.useState)(null),[q,R]=(0,Z.useState)(!1),Q=(0,Z.useCallback)(async(e,l)=>{try{await S.mutateAsync({node_id:l}),await w("/add-node/form/".concat(l)),window.location.reload()}catch(e){console.error("Error changing form:",e)}},[S,w]),{type:P,name:M}=l,O=(0,Z.useRef)(k);(0,Z.useEffect)(()=>{O.current=k},[k]);let U=(0,Z.useCallback)(async(e,l)=>{let n=O.current[e];E(l=>(0,j._)((0,y._)({},l),{[e]:!n}))},[]),H=(0,Z.useCallback)(async e=>{let l=null==e?void 0:e.id,n=null==e?void 0:e.listNodeType;try{await T.mutateAsync({BNodeClass:n,node_id:l},{onSuccess:async()=>{await N.invalidateQueries({queryKey:["infinite","apiData","class_attribute_field",{node_id:l}]}),await N.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:l}]})}})}catch(e){console.error("Error adding new node:",e)}},[T,N]),B=(0,Z.useCallback)(async e=>{W(e),F(!0),R(!0);let l=e.listNodeType.split(".").pop();try{var n,a,t,i;let e=await z.mutateAsync({type:l}),r=(null==e||null==(i=e.data)||null==(t=i.results)||null==(a=t[0])||null==(n=a.result)?void 0:n.data)||[];K(r)}catch(e){console.error("Error fetching class attribute field:",e)}finally{R(!1)}},[z]),$=(0,Z.useCallback)(async e=>{try{await A.mutateAsync({id:e.id,node_id:l.id},{onSuccess:async()=>{await N.invalidateQueries({queryKey:["infinite","apiData","class_attribute_field",{node_id:l.id}]}),S.mutate({node_id:n})}})}catch(e){console.error("Error adding existing node:",e)}},[A,S,n,l.id,N]),G=(0,Z.useCallback)((e,l)=>{$(e),F(!1)},[$]),X=Z.useMemo(()=>(null==d?void 0:d.pages)&&0!==d.pages.length?d.pages.reduce((e,l)=>{try{var n,a,t,i,r;let s=(null==l||null==(r=l.data)||null==(i=r.results)||null==(t=i[0])||null==(a=t.result)||null==(n=a.data)?void 0:n.attributes)||[];return e.push(...s),e}catch(l){return e}},[]):[],[d]);return(0,Z.useEffect)(()=>{if(!m&&(null==d?void 0:d.pages)&&X.length>0){let e={},l={};X.forEach(n=>{if(n.name&&"null"!==n.value&&void 0!==n.value){let a=(0,p.Tl)(n.id,n.name);e[a]=n.value,l[a]=n}})}},[m,null==d?void 0:d.pages,X]),(0,a.jsxs)(Z.Fragment,{children:[r?(0,a.jsx)(o.Z,{component:"form",className:"form-fields",onSubmit:e=>e.preventDefault(),sx:{mt:3},children:_?(0,a.jsxs)(u.Z,{color:"error",children:["Error loading fields: ",(null==C?void 0:C.message)||"Unknown error"]}):m&&0===X.length?(0,a.jsx)(u.Z,{children:"Loading fields..."}):X.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ev,{parentId:l.id,fields:X,expandedFields:k,toggleField:U,handleChangingForm:Q,rootId:n}),x&&(0,a.jsx)(o.Z,{sx:{mt:2,textAlign:"center"},children:(0,a.jsx)(c.Z,{variant:"outlined",onClick:()=>v(),disabled:f,size:"small",children:f?"Loading...":"Load More Fields"})})]}):(0,a.jsx)(u.Z,{children:"No fields available."})}):(0,a.jsxs)(o.Z,{className:"nested-fields",sx:{mt:2,pl:2,borderLeft:"1px solid #e0e0e0"},children:[s&&(_?(0,a.jsxs)(u.Z,{variant:"body2",color:"error",children:["Error loading subfields: ",(null==C?void 0:C.message)||"Unknown error"]}):m&&0===X.length?(0,a.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:"Loading subfields..."}):X.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ev,{parentId:l.id,fields:X,expandedFields:k,toggleField:U,handleChangingForm:Q,rootId:n}),x&&(0,a.jsx)(o.Z,{sx:{mt:1,textAlign:"center"},children:(0,a.jsx)(c.Z,{variant:"outlined",size:"small",onClick:()=>v(),disabled:f,sx:{fontSize:"0.75rem"},children:f?"Loading...":"Load More"})})]}):(0,a.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:"No subfields available for this."})),p.zS.includes(P)&&s&&l.canAddNewNode&&(0,a.jsxs)(b.Z,{direction:"row",spacing:2,className:"add-new-node",sx:{mt:2},children:[l.allowCreation&&(0,a.jsxs)(c.Z,{variant:"outlined",startIcon:(0,a.jsx)(i.Z,{}),onClick:()=>H(l),children:["Add new ",M]}),(0,a.jsxs)(c.Z,{variant:"outlined",startIcon:(0,a.jsx)(i.Z,{}),onClick:()=>B(l),children:["Add ",M," from Existing Node"]})]})]}),(0,a.jsx)(I,{show:L,selectedField:V,existingNodeList:D,loadingExistingNodes:q,onClose:()=>{F(!1),S.mutate({node_id:n})},onSelectNode:G})]})},(e,l)=>{var n,a;return e.fieldKey===l.fieldKey&&e.rootId===l.rootId&&e.isToggle===l.isToggle&&(null==(n=e.field)?void 0:n.id)===(null==(a=l.field)?void 0:a.id)}),eh=e=>{var l,n,y,j,b,Z,C,_,w,N,S,T;let{rawApiData:z,loading:I,error:A,refetch:k}=e,E=null==z||null==(l=z.data)?void 0:l.node_id,L=(0,h.NL)(),F=(0,g.s0)(),D=null==z||null==(C=z.data)||null==(Z=C.results)||null==(b=Z[0])||null==(j=b.result)||null==(y=j.data)||null==(n=y.currentNode)?void 0:n.name,K=(0,t.uC)("export_csv"),V=(0,t.uC)("remove_node"),W=(0,t.uC)("search_node",{onSuccess:async()=>{var e,l,n,a,t,i,r,s,o,d,u,c;await L.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:null==z||null==(i=z.data)||null==(t=i.results)||null==(a=t[0])||null==(n=a.result)||null==(l=n.data)||null==(e=l.attributes)?void 0:e.filter(e=>"results"===e.name)[0].id}]}),await L.invalidateQueries({queryKey:["infinite","apiData","class_attribute_field",{node_id:null==z||null==(c=z.data)||null==(u=c.results)||null==(d=u[0])||null==(o=d.result)||null==(s=o.data)||null==(r=s.attributes)?void 0:r.filter(e=>"results"===e.name)[0].id}]})}});return I?(0,a.jsx)(o.Z,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:(0,a.jsx)(d.Z,{})}):A?(0,a.jsxs)(u.Z,{color:"error",children:["Error loading form fields: ",A.message||"Unknown error"]}):(0,a.jsxs)(o.Z,{children:[(0,a.jsx)(ex,{fieldKey:(0,p.Tl)(E,D),rootId:E,isRoot:!0,field:{id:E}}),(null==z||null==(T=z.data)||null==(S=T.results)||null==(N=S[0])||null==(w=N.result)||null==(_=w.data.currentNode)?void 0:_.type)==="SearchForm"?(0,a.jsx)(c.Z,{variant:"contained",color:"primary",sx:{},onClick:()=>W.mutate({node_id:E,pageSize:1e3}),children:"Rechercher"}):"",(0,a.jsx)(m.Z,{ariaLabel:"SpeedDial playground example",sx:{position:"absolute",bottom:16,right:16},hidden:!1,icon:(0,a.jsx)(v.Z,{}),children:[{icon:(0,a.jsx)(s.Z,{}),name:"Exporter",onClick:async()=>{var e,l,n,a;let t=await K.mutateAsync({node_id:E,includeAllFields:!0,maxDepth:4}),i=new Blob([null==t||null==(a=t.data)||null==(n=a.results)||null==(l=n[0])||null==(e=l.result)?void 0:e.data],{type:"text/csv"});(0,f.saveAs)(i,"".concat(D,".csv"))}},{icon:(0,a.jsx)(i.Z,{}),name:"Ajouter une nouvelle entr\xe9e"},{icon:(0,a.jsx)(r.Z,{}),name:"Supprimer",onClick:async()=>{await V.mutateAsync({node_id:E,delete:!1},{onSuccess:async e=>{await k();var l,n,a,t,i,r,s,o,d=null==e||null==(t=e.data)||null==(a=t.results)||null==(n=a[0])||null==(l=n.result)?void 0:l.data,u="Those node will be affected : \n";for(let l=0;l<(null==e||null==(o=e.data)||null==(s=o.results)||null==(r=s[0])||null==(i=r.result)?void 0:i.data.length);l++)u+="".concat(d[l].id,"@").concat(d[l].class,", ");u+="\n\nAre you sure you want to delete this node ?",window.confirm(u)&&await V.mutateAsync({node_id:E,delete:!0},{onSuccess:async()=>{F(-1)}})}})}}].map(e=>(0,a.jsx)(x.Z,{icon:e.icon,tooltipTitle:e.name,onClick:e.onClick},e.name))})]})}},89803:function(e,l,n){n.d(l,{KX:()=>d,M1:()=>h,Qc:()=>o,Tl:()=>r,e$:()=>s,pG:()=>x,pt:()=>m,qG:()=>u,rj:()=>i,yT:()=>c,zS:()=>v});var a=n(27484),t=n.n(a);let i=e=>{if(!e)return"";let l=e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").trim();return l.charAt(0).toUpperCase()+l.slice(1)},r=(e,l)=>"".concat(e,"@").concat(l),s=(e,l,n)=>{if((null==n?void 0:n.required)&&(null==l||"string"==typeof l&&""===l.trim()||Array.isArray(l)&&0===l.length))return"Ce champ est requis";if((null==n?void 0:n.min)!==void 0&&"number"==typeof l&&l<n.min)return"La valeur doit \xeatre au moins ".concat(n.min);if((null==n?void 0:n.max)!==void 0&&"number"==typeof l&&l>n.max)return"La valeur doit \xeatre au plus ".concat(n.max);if(null==n?void 0:n.size){let e=Array.isArray(l)||"string"==typeof l?l.length:-1;if(-1!==e){if(void 0!==n.size.min&&e<n.size.min)return"Doit contenir au moins ".concat(n.size.min," caract\xe8res/\xe9l\xe9ments");if(void 0!==n.size.max&&e>n.size.max)return"Doit contenir au plus ".concat(n.size.max," caract\xe8res/\xe9l\xe9ments")}}if((null==n?void 0:n.pattern)&&"string"==typeof l&&!new RegExp(n.pattern).test(l))return"Doit correspondre au mod\xe8le : ".concat(n.pattern);switch(e){case"EmailNode":return"Veuillez entrer une adresse e-mail valide";case"IntNode":return"Veuillez entrer un entier valide";case"PhoneNumberNode":return"Veuillez entrer un num\xe9ro de t\xe9l\xe9phone valide";case"DateNode":return"Veuillez entrer une date valide";default:return"Valeur invalide"}},o=(e,l,n)=>{let a=!0,i="";if((null==n?void 0:n.required)&&(null==l||"string"==typeof l&&""===l.trim()||Array.isArray(l)&&0===l.length))return{isValid:a=!1,message:i="Ce champ est requis"};if(!(null==n?void 0:n.required)&&(null==l||"string"==typeof l&&""===l.trim()||Array.isArray(l)&&0===l.length))return{isValid:!0,message:""};if((null==n?void 0:n.min)!==void 0&&"number"==typeof l&&l<n.min)return{isValid:a=!1,message:i="La valeur doit \xeatre au moins ".concat(n.min)};if((null==n?void 0:n.max)!==void 0&&"number"==typeof l&&l>n.max)return{isValid:a=!1,message:i="La valeur doit \xeatre au plus ".concat(n.max)};if(null==n?void 0:n.size){let e=Array.isArray(l)||"string"==typeof l?l.length:-1;if(-1!==e){if(void 0!==n.size.min&&e<n.size.min)return{isValid:a=!1,message:i="Doit contenir au moins ".concat(n.size.min," caract\xe8res/\xe9l\xe9ments")};if(void 0!==n.size.max&&e>n.size.max)return{isValid:a=!1,message:i="Doit contenir au plus ".concat(n.size.max," caract\xe8res/\xe9l\xe9ments")}}}if((null==n?void 0:n.pattern)&&"string"==typeof l&&!new RegExp(n.pattern).test(l))return{isValid:a=!1,message:i="Doit correspondre au mod\xe8le : ".concat(n.pattern)};switch(e){case"IntNode":(a=/^-?\d+$/.test(l))||(i="Veuillez entrer un entier valide");break;case"DateNode":(a=t()(l).isValid())||(i="Veuillez entrer une date valide")}return{isValid:a,message:i}},d=["StringNode","EmailNode","PhoneNumberNode","IntNode","HistoryChangeNode","MimeTypeNode"],u=["BooleanNode","HideNode"],c=["DocumentNode"],m=["DateNode"],v=["ListNode"],x=["ColorNode"],h=[...d,...c,...u,...m,...x]}}]);
//# sourceMappingURL=1318.1e056e55.js.map