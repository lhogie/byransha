"use strict";(self.webpackChunklogin_page=self.webpackChunklogin_page||[]).push([["22"],{2462:function(e,l,n){n.r(l),n.d(l,{default:()=>eN});var a=n(5893),t=n(4997),r=n(4786),i=n(1215),s=n(4757),o=n(2903),d=n(9126),u=n(1035),c=n(7230),m=n(6972),p=n(1967),x=n(9e3),v=n(3627),h=n(8655),f=n(7409),g=n(9282),y=n(7294),j=n(7178),b=n(1419),C=n(6770),Z=n(2153),_=n(1731),w=n(9717),N=n(6896);let k=y.memo(e=>{let{show:l,selectedField:n,existingNodeList:t,loadingExistingNodes:o,onClose:d,onSelectNode:c}=e,[m,p]=(0,y.useState)(""),x=(0,y.useCallback)(e=>{p(e.target.value)},[]),h=(0,y.useCallback)(()=>{d()},[d]),f=(0,y.useMemo)(()=>t.filter(e=>e.name.toLowerCase().includes(m.toLowerCase())),[t,m]),g=(0,y.useCallback)(e=>{c(e,n)},[c,n]);return(0,a.jsx)(C.Z,{open:l,onClose:h,"aria-labelledby":"existing-node-modal-title","aria-describedby":"existing-node-modal-description",children:(0,a.jsx)(r.Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"80%",maxWidth:600,maxHeight:"80vh",bgcolor:"background.paper",boxShadow:24,outline:"none"},children:(0,a.jsxs)(Z.Z,{className:"existing-node-card",sx:{width:"100%",maxHeight:"80vh",overflow:"auto"},children:[(0,a.jsx)(_.Z,{id:"existing-node-modal-title",title:"Select Existing Node",action:(0,a.jsx)(u.Z,{onClick:h,"aria-label":"close",children:(0,a.jsx)(v.Z,{})})}),(0,a.jsxs)(w.Z,{children:[(0,a.jsx)(N.Z,{fullWidth:!0,variant:"outlined",placeholder:"Search nodes...",value:m,onChange:x,sx:{mb:2}}),(0,a.jsx)(r.Z,{className:"node-list",sx:{maxHeight:"50vh",overflow:"auto"},children:o?(0,a.jsxs)(r.Z,{display:"flex",justifyContent:"center",p:2,children:[(0,a.jsx)(i.Z,{size:24})," ",(0,a.jsx)(s.Z,{sx:{ml:1},children:"Loading nodes..."})]}):(0,a.jsx)(j.Z,{spacing:1,children:f.map(e=>(0,a.jsx)(r.Z,{sx:{p:2,cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},onClick:()=>g(e),children:(0,a.jsx)(s.Z,{fontWeight:"bold",children:e.name})},e.id))})})]})]})})})});var E=n(7484),F=n.n(E);let I=e=>{if(!e)return"";let l=e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").trim();return l.charAt(0).toUpperCase()+l.slice(1)},A=(e,l)=>"".concat(e,"@").concat(l),L=(e,l,n)=>{if((null==n?void 0:n.required)&&(null==l||"string"==typeof l&&""===l.trim()||Array.isArray(l)&&0===l.length))return"Ce champ est requis";if((null==n?void 0:n.min)!==void 0&&"number"==typeof l&&l<n.min)return"La valeur doit \xeatre au moins ".concat(n.min);if((null==n?void 0:n.max)!==void 0&&"number"==typeof l&&l>n.max)return"La valeur doit \xeatre au plus ".concat(n.max);if(null==n?void 0:n.size){let e=Array.isArray(l)||"string"==typeof l?l.length:-1;if(-1!==e){if(void 0!==n.size.min&&e<n.size.min)return"Doit contenir au moins ".concat(n.size.min," caract\xe8res/\xe9l\xe9ments");if(void 0!==n.size.max&&e>n.size.max)return"Doit contenir au plus ".concat(n.size.max," caract\xe8res/\xe9l\xe9ments")}}if((null==n?void 0:n.pattern)&&"string"==typeof l&&!new RegExp(n.pattern).test(l))return"Doit correspondre au mod\xe8le : ".concat(n.pattern);switch(e){case"EmailNode":return"Veuillez entrer une adresse e-mail valide";case"IntNode":return"Veuillez entrer un entier valide";case"PhoneNumberNode":return"Veuillez entrer un num\xe9ro de t\xe9l\xe9phone valide";case"DateNode":return"Veuillez entrer une date valide";default:return"Valeur invalide"}},D=(e,l,n)=>{let a=!0,t="";if((null==n?void 0:n.required)&&(null==l||"string"==typeof l&&""===l.trim()||Array.isArray(l)&&0===l.length))return{isValid:a=!1,message:t="Ce champ est requis"};if(!(null==n?void 0:n.required)&&(null==l||"string"==typeof l&&""===l.trim()||Array.isArray(l)&&0===l.length))return{isValid:!0,message:""};if((null==n?void 0:n.min)!==void 0&&"number"==typeof l&&l<n.min)return{isValid:a=!1,message:t="La valeur doit \xeatre au moins ".concat(n.min)};if((null==n?void 0:n.max)!==void 0&&"number"==typeof l&&l>n.max)return{isValid:a=!1,message:t="La valeur doit \xeatre au plus ".concat(n.max)};if(null==n?void 0:n.size){let e=Array.isArray(l)||"string"==typeof l?l.length:-1;if(-1!==e){if(void 0!==n.size.min&&e<n.size.min)return{isValid:a=!1,message:t="Doit contenir au moins ".concat(n.size.min," caract\xe8res/\xe9l\xe9ments")};if(void 0!==n.size.max&&e>n.size.max)return{isValid:a=!1,message:t="Doit contenir au plus ".concat(n.size.max," caract\xe8res/\xe9l\xe9ments")}}}if((null==n?void 0:n.pattern)&&"string"==typeof l&&!new RegExp(n.pattern).test(l))return{isValid:a=!1,message:t="Doit correspondre au mod\xe8le : ".concat(n.pattern)};switch(e){case"IntNode":(a=/^-?\d+$/.test(l))||(t="Veuillez entrer un entier valide");break;case"DateNode":(a=F()(l).isValid())||(t="Veuillez entrer une date valide")}return{isValid:a,message:t}},S=["StringNode","EmailNode","PhoneNumberNode","IntNode"],T=["BooleanNode"],z=["DateNode"],K=["ImageNode"],V=["FileNode"],P=["ListNode"],R=["ColorNode"],W=[...S,...V,...T,...z,...R];var q=n(9469),U=n(4651),O=n(3892),Q=n(2719),B=n(9298),H=n(8848);let $=e=>{var{field:l,fieldKey:n,value:t,onFocus:r,onChange:i,error:s,helperText:o}=e,d=(0,H._)(e,["field","fieldKey","value","onFocus","onChange","error","helperText"]);let u={};return l.validations&&("IntNode"===l.type&&void 0!==l.validations.min&&(u.min=l.validations.min),"IntNode"===l.type&&void 0!==l.validations.max&&(u.max=l.validations.max),l.validations.size&&(void 0!==l.validations.size.min&&(u.minLength=l.validations.size.min),void 0!==l.validations.size.max&&(u.maxLength=l.validations.size.max))),(0,a.jsx)(N.Z,(0,f._)({fullWidth:!0,id:n,variant:"outlined",type:(e=>{switch(e){case"EmailNode":return"email";case"PhoneNumberNode":return"tel";case"IntNode":return"number";default:return"text"}})(l.type),value:t||"",onFocus:r,onChange:e=>i(e.target.value),error:s,helperText:o,inputProps:u},d))};var M=n(2095),X=n(5714);let G=e=>{let l,n;var{fieldKey:t,value:r,onChange:i,error:s,helperText:o,field:d}=e,u=(0,H._)(e,["fieldKey","value","onChange","error","helperText","field"]);return(null==d?void 0:d.validations)&&(void 0!==d.validations.min&&(l=F()(d.validations.min)),void 0!==d.validations.max&&(n=F()(d.validations.max))),(0,a.jsxs)(O.Z,{fullWidth:!0,error:s,children:[(0,a.jsx)(M.M,(0,g._)((0,f._)({value:r?F()(r):null,onChange:e=>i(e),sx:{width:"100%"},minDate:l,maxDate:n},u),{slotProps:{textField:{size:"small",error:s}}})),o&&(0,a.jsx)(X.Z,{children:o})]})};var J=n(9380),Y=n(9276);let ee=e=>{var{fieldKey:l,value:n,onFocus:t,onChange:r}=e,i=(0,H._)(e,["fieldKey","value","onFocus","onChange"]);return(0,a.jsx)(J.Z,{control:(0,a.jsx)(Y.Z,(0,f._)({id:l,checked:!!n,onChange:e=>r(e.target.checked)},i)),label:""})},el=e=>{var{field:l,fieldKey:n,value:t,onFocus:i,onChange:s}=e,o=(0,H._)(e,["field","fieldKey","value","onFocus","onChange"]);return(0,a.jsxs)(r.Z,{className:"image-preview-wrapper",sx:{display:"flex",flexDirection:"column",alignItems:"center",mt:2},children:[t&&(0,a.jsx)(r.Z,{component:"img",className:"image-preview",src:"data:".concat(l.mimeType,";base64,").concat(t),alt:l.name,sx:{maxHeight:"150px",width:"auto",objectFit:"contain",mt:1,border:"1px solid #eee"}}),(0,a.jsxs)(c.Z,{variant:"contained",component:"label",sx:{mt:2},children:["Upload New Image",(0,a.jsx)(N.Z,(0,f._)({type:"file",accept:"image/*",sx:{display:"none"},onClick:i,onChange:async e=>{var l;let n=null==(l=e.target.files)?void 0:l[0];if(!n)return;let a=new FileReader;a.onloadend=async()=>{if("string"==typeof(null==a?void 0:a.result)){var e;s(null==a||null==(e=a.result)?void 0:e.split(",")[1])}},a.readAsDataURL(n)}},o))]})]})};var en=n(4697),ea=n(1786);let et=e=>{var l,n,t,r,i,s,o,d,u,c,m,p,x,v,j,b,C,Z,_,w,k,E,F,I,A,L,{field:D,fieldKey:S,value:T,defaultValue:z,onFocus:K,onChange:V,onFirstChange:P,error:R,helperText:W,multiple:q=!1}=e,U=(0,H._)(e,["field","fieldKey","value","defaultValue","onFocus","onChange","onFirstChange","error","helperText","multiple"]);let Q=null==(l=D.listNodeType)?void 0:l.split(".").pop(),B=D.choices||[],$=B.length>0,{data:M,isLoading:G,isError:J}=(0,h.m_)("class_attribute_field",{node_id:D.id});(0,y.useEffect)(()=>{var e,l,n,a,t,r,i,s,o,d,u,c,m;$||G||J||(null==M||null==(r=M.data)||null==(t=r.results)||null==(a=t[0])||null==(n=a.result)||null==(l=n.data)||null==(e=l.attributes)?void 0:e.length)===0||P(null==M||null==(m=M.data)||null==(c=m.results)||null==(u=c[0])||null==(d=u.result)||null==(o=d.data)||null==(s=o.attributes)||null==(i=s.map(e=>({label:e.name.split(". ")[1],value:e.id})))?void 0:i[0])},[$,G,J,P,null==M||null==(o=M.data)||null==(s=o.results)||null==(i=s[0])||null==(r=i.result)||null==(t=r.data)||null==(n=t.attributes)?void 0:n.length,null==M||null==(x=M.data)||null==(p=x.results)||null==(m=p[0])||null==(c=m.result)||null==(u=c.data)||null==(d=u.attributes)?void 0:d.map]);let{data:Y,isLoading:ee,isError:el,error:en}=(0,h.m_)($?void 0:"list_existing_node",{type:Q});return(0,y.useEffect)(()=>{var e,l,n,a,t,r,i,s,o;if($&&!ee&&!el&&(null==Y||null==(t=Y.data)||null==(a=t.results)||null==(n=a[0])||null==(l=n.result)||null==(e=l.data)?void 0:e.length)!==0&&!q)if(z){let e=Number.parseInt(z.split("@")[1]),l=null==Y||null==(o=Y.data)||null==(s=o.results)||null==(i=s[0])||null==(r=i.result)?void 0:r.data.find(l=>l.id===e);l?P({label:l.name,value:l.id}):P(void 0)}else P(void 0)},[$,ee,el,z,null==Y||null==(C=Y.data)||null==(b=C.results)||null==(j=b[0])||null==(v=j.result)?void 0:v.data.find,null==Y||null==(E=Y.data)||null==(k=E.results)||null==(w=k[0])||null==(_=w.result)||null==(Z=_.data)?void 0:Z.length,q,P]),(0,a.jsxs)(O.Z,{fullWidth:!0,error:R,children:[(0,a.jsx)(ea.Z,(0,f._)({disablePortal:!0,renderInput:e=>(0,a.jsx)(N.Z,(0,g._)((0,f._)({},e),{error:R})),options:$?B.map(e=>({label:e,value:e,firstLetter:e[0].toUpperCase()})):(null==Y||null==(L=Y.data)||null==(A=L.results)||null==(I=A[0])||null==(F=I.result)?void 0:F.data.map(e=>{let l=e.name[0].toUpperCase();return{label:e.name,value:e.id,firstLetter:"France(FR)"===e.name?" ":/[0-9]/.test(l)?"0-9":l}}).sort((e,l)=>e.firstLetter!==l.firstLetter?e.firstLetter.localeCompare(l.firstLetter):e.label.localeCompare(l.label)))||[],groupBy:e=>e.firstLetter,getOptionKey:e=>{var l;return null!=(l=e.value)?l:""},getOptionLabel:e=>{var l;return null!=(l=e.label)?l:""},isOptionEqualToValue:(e,l)=>e.value===l.value,size:"small",id:S,value:T,onChange:(e,l)=>{V(l)},multiple:q},U)),W&&(0,a.jsx)(X.Z,{children:W})]})};var er=n(7942),ei=n(6762),es=n(4791);let eo=e=>{var l,{field:n,fieldKey:t,value:r,defaultValue:i,onFocus:s,onChange:o,error:d,helperText:u,onFirstChange:c}=e,m=(0,H._)(e,["field","fieldKey","value","defaultValue","onFocus","onChange","error","helperText","onFirstChange"]);return(0,a.jsxs)(O.Z,{fullWidth:!0,error:d,children:[(0,a.jsx)(ei.Z,(0,g._)((0,f._)({row:!0,name:t,value:r||i,onChange:e=>o(e.target.value),onFocus:s},m),{children:null==(l=n.choices)?void 0:l.map((e,l)=>(0,a.jsx)(J.Z,{value:l,control:(0,a.jsx)(es.Z,{}),label:e},l))})),u&&(0,a.jsx)(X.Z,{children:u})]})};var ed=n(7884);let eu=e=>{let{option:l,fieldId:n}=e,[t,r]=(0,y.useState)(l.value),i=(0,h.uC)("set_value"),s=(0,q.NL)(),o=(0,en.y1)(async e=>{if(!e)return console.warn("No field provided for saving changes");try{await er.ZP.promise(i.mutateAsync({id:e.id,value:t},{onSuccess:async()=>{await s.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:Number.parseInt(n)}]})}}),{loading:"Enregistrement de ".concat(I(e.name),"..."),success:"Changements enregistr\xe9s pour ".concat(I(e.name)),error:"Erreur lors de l'enregistrement des changements pour ".concat(I(e.name))})}catch(e){console.error("Error saving changes:",e)}},500,{maxWait:2e3});return(0,a.jsx)(J.Z,{label:l.name,control:(0,a.jsx)(Y.Z,{checked:t||!1,onChange:e=>{r(e.target.checked),o(l)}})})},ec=e=>{var l,n,t,r,i,s;let{field:o,error:d,helperText:u}=e,{data:c}=(0,h.m_)("class_attribute_field",{node_id:o.id});return(0,a.jsxs)(O.Z,{fullWidth:!0,error:d,children:[(0,a.jsx)(ed.Z,{row:!0,children:null==c||null==(s=c.data)||null==(i=s.results)||null==(r=i[0])||null==(t=r.result)||null==(n=t.data)||null==(l=n.attributes)?void 0:l.map((e,l)=>(0,a.jsx)(eu,{option:e,fieldId:o.id},l))}),u&&(0,a.jsx)(X.Z,{children:u})]})};var em=n(3180),ep=n(4649),ex=n(5471);n(4493),n(3608);var ev=n(1994);em.Tu.workerSrc=new URL(n(7663),n.b).toString();let eh=e=>{let{value:l,onChange:n,error:t,helperText:o}=e,[u,m]=(0,y.useState)(l);return(0,y.useEffect)(()=>{if(l){let e=atob(l),n=Array(e.length);for(let l=0;l<e.length;l++)n[l]=e.charCodeAt(l);let a=new Blob([new Uint8Array(n)],{type:"application/pdf"});m(URL.createObjectURL(a))}},[l]),(0,a.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},children:[(0,a.jsx)(d.Z,{elevation:2,onClick:e=>{e.stopPropagation(),u&&window.open(u,"_blank","noopener,noreferrer")},sx:{cursor:"pointer",border:"2px solid ".concat(t?"error.main":"transparent"),borderRadius:"8px",width:"180px",height:"254px",overflow:"hidden",position:"relative",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"#f8f8f8",mb:2,transition:"all 0.2s ease-in-out","&:hover":{borderColor:"primary.main",boxShadow:4,transform:"scale(1.02)"}},children:u?(0,a.jsx)(ep.Z,{file:u,loading:(0,a.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,a.jsx)(i.Z,{size:40,sx:{mb:1}}),(0,a.jsx)(s.Z,{variant:"caption",color:"text.secondary",children:"Loading PDF..."})]}),error:(0,a.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:2},children:[(0,a.jsx)(ev.Z,{color:"error",sx:{fontSize:40,mb:1}}),(0,a.jsx)(s.Z,{variant:"caption",color:"error",children:"Preview not available"})]}),children:(0,a.jsx)(ex.Z,{pageNumber:1,width:180,renderTextLayer:!1,renderAnnotationLayer:!1})}):(0,a.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:2},children:[(0,a.jsx)(ev.Z,{color:"disabled",sx:{fontSize:60,mb:1}}),(0,a.jsx)(s.Z,{variant:"caption",color:"text.secondary",align:"center",children:"No PDF selected"})]})}),(0,a.jsxs)(c.Z,{variant:"contained",component:"label",color:"primary",startIcon:(0,a.jsx)(ev.Z,{}),sx:{mt:1},children:["Upload PDF",(0,a.jsx)("input",{type:"file",hidden:!0,accept:"application/pdf",onChange:e=>{let l=e.target.files[0];if(l&&"application/pdf"===l.type){let e=new FileReader;e.onloadend=()=>{if("string"==typeof e.result){var l;n(null==(l=e.result)?void 0:l.split(",")[1])}},e.readAsDataURL(l)}else l&&(alert("Please select a PDF file."),e.target.value=null)}})]}),o&&(0,a.jsx)(s.Z,{color:t?"error":"textSecondary",variant:"caption",sx:{mt:1},children:o})]})},ef=e=>{var l,n,t,r,i,s,o,d,u,c,m,p,{field:x,fieldKey:v,value:g,onFocus:j,onChange:b,onFirstChange:C,error:Z,helperText:_}=e,w=(0,H._)(e,["field","fieldKey","value","onFocus","onChange","onFirstChange","error","helperText"]);let{data:N,isLoading:k,isError:E}=(0,h.m_)("class_attribute_field",{node_id:x.id});return(0,y.useEffect)(()=>{var e,l,n,a,t,r,i,s,o,d,u,c;k||E||(null==N||null==(r=N.data)||null==(t=r.results)||null==(a=t[0])||null==(n=a.result)||null==(l=n.data)||null==(e=l.attributes)?void 0:e.length)===0||C(null==N||null==(c=N.data)||null==(u=c.results)||null==(d=u[0])||null==(o=d.result)||null==(s=o.data)||null==(i=s.attributes)?void 0:i.map(e=>({firstLetter:e.name.split(". ")[1][0],label:e.name.split(". ")[1],value:e.id})))},[k,E,C,null==N||null==(s=N.data)||null==(i=s.results)||null==(r=i[0])||null==(t=r.result)||null==(n=t.data)||null==(l=n.attributes)?void 0:l.length,null==N||null==(p=N.data)||null==(m=p.results)||null==(c=m[0])||null==(u=c.result)||null==(d=u.data)||null==(o=d.attributes)?void 0:o.map]),(0,a.jsx)(et,(0,f._)({field:x,fieldKey:v,value:g,onChange:b,onFirstChange:C,error:Z,helperText:_,multiple:!0},w))};var eg=n(770);let ey=e=>{var{value:l,onFocus:n,onChange:t,error:r,helperText:i}=e,o=(0,H._)(e,["value","onFocus","onChange","error","helperText"]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eg.Z,(0,f._)({style:{marginLeft:20},color:l||"",onFocus:n,onChange:e=>{t(e.hex)}},o)),i&&(0,a.jsx)(s.Z,{color:r?"error":"textSecondary",variant:"caption",sx:{mt:1},children:i})]})},ej=y.memo(e=>{let{field:l,fieldKey:n,isExpanded:t,onToggleField:i,onChangingForm:o,parentId:d,defaultValue:m=""}=e,{id:p,name:x,type:v,validations:f,isValid:g,choices:j,source:b}=l,[C,Z]=(0,y.useState)(P.includes(v)?"RADIO"===l.listType?l.value:[]:m),[_,w]=(0,y.useState)(!1),[N,k]=(0,y.useState)(""),E=(0,q.NL)(),F=(0,h.uC)("set_value"),A=(0,h.uC)("add_existing_node"),H=(0,h.uC)("remove_from_list"),M=(0,en.y1)(e=>{let l=D(v,e,f);return w(!l.isValid),k(l.message),l.isValid},300,{maxWait:1e3});(0,y.useEffect)(()=>{M(C)},[C,M]);let X=(0,en.y1)(async e=>{if(!e)return console.warn("No field provided for saving changes");if(!M(C))return void"Invalid value for ".concat(e.name," (").concat(e.type,"): ").concat(C);try{await er.ZP.promise(F.mutateAsync({id:e.id,value:C,parentId:d},{onSuccess:async()=>{await E.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:Number.parseInt(d)}]})}}),{loading:"Enregistrement de ".concat(I(e.name),"..."),success:"Changements enregistr\xe9s pour ".concat(I(e.name)),error:"Erreur lors de l'enregistrement des changements pour ".concat(I(e.name))})}catch(e){console.error("Error saving changes:",e),w(!0),k("Error saving changes: ".concat(e.message))}},500,{maxWait:2e3}),J=(0,y.useCallback)(async e=>{if(!e)return void Z(null);Z(e);try{await er.ZP.promise(F.mutateAsync({id:l.id,value:e},{onSuccess:async()=>{await E.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:Number.parseInt(d)}]})}}),{loading:"Enregistrement de ".concat(I(l.name),"..."),success:"Changements enregistr\xe9s pour ".concat(I(l.name)),error:"Erreur lors de l'enregistrement des changements pour ".concat(I(l.name))})}catch(e){console.error("Error saving changes:",e),w(!0),k("Error saving changes: ".concat(e.message))}},[l.id,l.name,d,E.invalidateQueries,F.mutateAsync]),Y=(0,en.y1)(async function(e,l){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(!e)return console.warn("No field provided for saving changes");if(!M(l))return void"Invalid value for ".concat(e.name," (").concat(e.type,"): ").concat(l);try{await er.ZP.promise((n?A:H).mutateAsync({node_id:e.id,id:l},{onSuccess:async()=>{await E.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:Number.parseInt(d)}]})}}),{loading:"Enregistrement de ".concat(I(e.name),"..."),success:"Changements enregistr\xe9s pour ".concat(I(e.name)),error:"Erreur lors de l'enregistrement des changements pour ".concat(I(e.name))})}catch(e){console.error("Error saving changes:",e),w(!0),k("Error saving changes: ".concat(e.message))}}),ea=(0,y.useCallback)(function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let n=D(l.type,e,f);w(!n),n?k(""):k(L(l.type,e,f)),X(l),Z(e)},[l,X,f]),ei=(0,y.useCallback)(e=>{let n=D(l.type,null==e?void 0:e.value,f);w(!n),n?k(""):k(L(l.type,null==e?void 0:e.value,f)),Y(l,null==e?void 0:e.value),Z(e)},[l,Y,f]),es=(0,y.useCallback)(e=>{Z(e)},[]),ed=(0,y.useCallback)(e=>{if(!M(e))return;let n=C||[],a=e||[],t=a.filter(e=>!n.some(l=>l.value===e.value));t.length>0&&t.forEach(e=>{Y(l,e.value)});let r=n.filter(e=>!a.some(l=>l.value===e.value));r.length>0&&r.forEach(e=>{Y(l,e.value,!1)}),Z(e)},[l,Y,C,M]),eu=(0,y.useCallback)(e=>Z(e),[]),em=(0,y.useCallback)(()=>{o(x,p)},[o,x,p]),ep=(0,y.useCallback)(()=>{i(n,p)},[i,n,p]);return(0,y.useEffect)(()=>()=>{X.flush()},[X]),(0,a.jsx)(r.Z,{className:"form-field-wrapper",sx:{p:1},children:(0,a.jsxs)(U.Z,{container:!0,className:"form-field",spacing:2,alignItems:"center",children:[(0,a.jsx)(U.Z,{size:{xs:12,sm:4},children:(0,a.jsxs)(O.Z,{component:"fieldset",sx:{display:"flex",flexDirection:"row"},children:[(0,a.jsx)(c.Z,{tabIndex:-1,variant:"text",color:"primary",onClick:em,title:n,sx:{textAlign:"left",justifyContent:"flex-start"},children:(0,a.jsx)(s.Z,{fontWeight:"medium",color:!1===g?"error":"primary",sx:{fontWeight:!1===g?"bold":"regular"},children:I(x)})}),!(W.includes(v)||P.includes(v)&&"LIST"!==l.listType)&&(0,a.jsx)(r.Z,{className:"toggle-wrapper",textAlign:"right",children:(0,a.jsx)(u.Z,{onClick:ep,size:"small",children:t?(0,a.jsx)(B.Z,{}):(0,a.jsx)(Q.Z,{})})})]})}),(0,a.jsxs)(U.Z,{size:{xs:12,sm:6},children:[P.includes(v)&&"CHECKBOX"===l.listType&&(0,a.jsx)(ec,{field:l,error:_,helperText:_?N:""}),S.includes(v)&&(0,a.jsx)($,{field:l,fieldKey:n,value:C,onChange:ea,size:"small",error:_,helperText:_?N:""}),z.includes(v)&&(0,a.jsx)(G,{fieldKey:n,field:l,value:C,onChange:ea,error:_,helperText:_?N:""}),T.includes(v)&&(0,a.jsx)(ee,{fieldKey:n,value:C,onChange:ea}),K.includes(v)&&t&&(0,a.jsx)(el,{field:l,fieldKey:n,value:C,onChange:ea,size:"small"}),P.includes(v)&&"DROPDOWN"===l.listType&&(0,a.jsx)(et,{field:l,fieldKey:n,value:null!=C?C:null,onChange:ei,onFirstChange:es,defaultValue:m,error:_,helperText:_?N:""}),P.includes(v)&&l.isDropdown&&(0,a.jsx)(ef,{field:l,fieldKey:n,value:null!=C?C:[],onChange:ed,onFirstChange:eu,error:_,helperText:_?N:""}),P.includes(v)&&"RADIO"===l.listType&&(0,a.jsx)(eo,{field:l,fieldKey:n,value:C,onChange:ea,onFirstChange:es,defaultValue:m,error:_,helperText:_?N:""}),V.includes(v)&&(0,a.jsx)(eh,{value:C,onChange:J,error:_,helperText:N}),R.includes(v)&&(0,a.jsx)(ey,{value:C,onChange:ea,error:_,helperText:N})]})]})},n)},(e,l)=>e.fieldKey===l.fieldKey&&e.isExpanded===l.isExpanded&&e.onToggleField===l.onToggleField&&e.defaultValue===l.defaultValue),eb=e=>{let{parentId:l,fields:n,visited:t=new Set,expandedFields:r,toggleField:i,handleChangingForm:o,rootId:d}=e;return n&&Array.isArray(n)?n.map(e=>{let{id:n,name:u,type:c}=e;if(!u||"graph"===u)return null;let m=A(e.id,e.name);if(t.has(n))return(0,a.jsxs)(s.Z,{color:"error",children:["Circular reference detected for ",u]},"cycle-".concat(n));let p=r[m]||!1;return(0,a.jsxs)(y.Fragment,{children:[(0,a.jsx)(ej,{field:e,fieldKey:m,isExpanded:p,onToggleField:i,onChangingForm:o,defaultValue:e.value,parentId:l}),!(W.includes(c)||P.includes(c)&&"LIST"!==e.listType)&&(0,a.jsx)(eC,{fieldKey:m,field:e,rootId:d,isToggle:p})]},m)}):null},eC=y.memo(e=>{var l,n,i,o,d,u;let{fieldKey:m,field:p,rootId:x,isRoot:v=!1,isToggle:C=!1}=e,{data:Z,isLoading:_,error:w,refetch:N}=(0,h.m_)("class_attribute_field",{node_id:"string"==typeof p.id?Number.parseInt(p.id):p.id},{enabled:C||v}),E=(0,t.s0)(),F=(0,q.NL)(),I=(0,h.uC)("jump"),L=(0,h.uC)("add_node"),D=(0,h.uC)("list_existing_node"),S=(0,h.uC)("add_existing_node"),[T,z]=(0,y.useState)({}),[K,V]=(0,y.useState)(!1),[R,W]=(0,y.useState)([]),[U,O]=(0,y.useState)(null),[Q,B]=(0,y.useState)(!1),H=(0,y.useCallback)(async(e,l)=>{try{await I.mutateAsync({node_id:l}),await E("/add-node/form/".concat(l)),window.location.reload()}catch(e){console.error("Error changing form:",e)}},[I,E]),{id:$,type:M,name:X}=p,G=(0,y.useRef)(T);(0,y.useEffect)(()=>{G.current=T},[T]);let J=(0,y.useCallback)(async(e,l)=>{let n=G.current[e];z(l=>(0,g._)((0,f._)({},l),{[e]:!n}))},[]),Y=(0,y.useCallback)(async e=>{let l=null==e?void 0:e.id,n=null==e?void 0:e.listNodeType;try{await L.mutateAsync({BNodeClass:n,node_id:l},{onSuccess:async()=>{await F.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:l}]})}})}catch(e){console.error("Error adding new node:",e)}},[L,F.invalidateQueries]),ee=(0,y.useCallback)(async e=>{O(e),V(!0),B(!0);let l=e.listNodeType.split(".").pop();try{var n,a,t,r;let e=await D.mutateAsync({type:l}),i=(null==e||null==(r=e.data)||null==(t=r.results)||null==(a=t[0])||null==(n=a.result)?void 0:n.data)||[];W(i)}catch(e){console.error("Error fetching class attribute field:",e)}finally{B(!1)}},[D]),el=(0,y.useCallback)(async e=>{try{await S.mutateAsync({id:e.id,node_id:p.id},{onSuccess:async()=>{await F.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:p.id}]}),I.mutate({node_id:x})}})}catch(e){console.error("Error adding existing node:",e)}},[S,I,x,p.id,F.invalidateQueries]),en=(0,y.useCallback)((e,l)=>{el(e),V(!1)},[el]);(0,y.useEffect)(()=>{if(!_&&Z){var e,l,n,a,t;let r={},i={};((null==Z||null==(t=Z.data)||null==(a=t.results)||null==(n=a[0])||null==(l=n.result)||null==(e=l.data)?void 0:e.attributes)||[]).forEach(e=>{if(e.name&&"null"!==e.value&&void 0!==e.value){let l=A(e.id,e.name);r[l]=e.value,i[l]=e}})}},[_,Z]);let ea=(null==Z||null==(d=Z.data)||null==(o=d.results)||null==(i=o[0])||null==(n=i.result)||null==(l=n.data)?void 0:l.attributes)||[];return(0,a.jsxs)(y.Fragment,{children:[v?(0,a.jsx)(r.Z,{component:"form",className:"form-fields",onSubmit:e=>e.preventDefault(),sx:{mt:3},children:ea.length>0?(0,a.jsx)(eb,{parentId:p.id,fields:ea,expandedFields:T,toggleField:J,handleChangingForm:H,rootId:x}):(0,a.jsx)(s.Z,{children:"No fields available."})}):(0,a.jsxs)(r.Z,{className:"nested-fields",sx:{mt:2,pl:2,borderLeft:"1px solid #e0e0e0"},children:[C&&(ea.length>0?(0,a.jsx)(eb,{parentId:p.id,fields:ea,expandedFields:T,toggleField:J,handleChangingForm:H,rootId:x}):(0,a.jsx)(s.Z,{variant:"body2",color:"text.secondary",children:"No subfields available for this."})),P.includes(M)&&C&&p.canAddNewNode&&(0,a.jsxs)(j.Z,{direction:"row",spacing:2,className:"add-new-node",sx:{mt:2},children:[null!=(u=p.allowCreation)?u:(0,a.jsxs)(c.Z,{variant:"outlined",startIcon:(0,a.jsx)(b.Z,{}),onClick:()=>Y(p),children:["Add new ",X]}),(0,a.jsxs)(c.Z,{variant:"outlined",startIcon:(0,a.jsx)(b.Z,{}),onClick:()=>ee(p),children:["Add ",X," from Existing Node"]})]})]}),(0,a.jsx)(k,{show:K,selectedField:U,existingNodeList:R,loadingExistingNodes:Q,onClose:()=>{V(!1),I.mutate({node_id:x})},onSelectNode:en})]})},(e,l)=>e.fieldKey===l.fieldKey&&e.rootId===l.rootId&&e.isToggle===l.isToggle);var eZ=n(9599),e_=n(7454),ew=n(3162);let eN=()=>{var e,l,n,f,g,y,j,C,Z,_,w;let{rootId:N}=(0,t.UO)(),k=N?parseInt(N):0,E=(0,q.NL)(),F=(0,t.s0)(),{data:L,isLoading:D,error:S,refetch:T}=(0,h.m_)("class_attribute_field",{node_id:k}),z=null==L||null==(y=L.data)||null==(g=y.results)||null==(f=g[0])||null==(n=f.result)||null==(l=n.data)||null==(e=l.currentNode)?void 0:e.name,K=(0,h.uC)("export_csv"),V=(0,h.uC)("remove_node"),P=(0,h.uC)("search_node",{onSuccess:async()=>{var e,l,n,a,t,r;await E.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:null==L||null==(r=L.data)||null==(t=r.results)||null==(a=t[0])||null==(n=a.result)||null==(l=n.data)||null==(e=l.attributes)?void 0:e.filter(e=>"results"===e.name)[0].id}]})}});return D?(0,a.jsx)(r.Z,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:(0,a.jsx)(i.Z,{})}):S?(0,a.jsxs)(s.Z,{color:"error",children:["Error loading form fields: ",S.message||"Unknown error"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(o.Z,{className:"form-page",component:d.Z,elevation:3,sx:{p:3,position:"relative"},children:[(0,a.jsx)(u.Z,{className:"close-button",onClick:()=>F(-1),"aria-label":"close",sx:{position:"absolute",top:16,right:16},children:(0,a.jsx)(v.Z,{})}),(0,a.jsxs)(s.Z,{variant:"h4",component:"h1",gutterBottom:!0,children:["Form for: ",I(z)]}),(0,a.jsx)(eC,{fieldKey:A(k,z),rootId:k,isRoot:!0,field:{id:k}}),(null==L||null==(w=L.data)||null==(_=w.results)||null==(Z=_[0])||null==(C=Z.result)||null==(j=C.data.currentNode)?void 0:j.type)==="SearchForm"?(0,a.jsx)(c.Z,{variant:"contained",color:"primary",sx:{},onClick:()=>P.mutate({node_id:k}),children:"Rechercher"}):""]}),(0,a.jsx)(m.Z,{ariaLabel:"SpeedDial playground example",sx:{position:"absolute",bottom:16,right:16},hidden:!1,icon:(0,a.jsx)(p.Z,{}),children:[{icon:(0,a.jsx)(eZ.Z,{}),name:"Exporter",onClick:async()=>{var e,l,n,a;let t=await K.mutateAsync({node_id:k,includeAllFields:!0,maxDepth:4}),r=new Blob([null==t||null==(a=t.data)||null==(n=a.results)||null==(l=n[0])||null==(e=l.result)?void 0:e.data],{type:"text/csv"});(0,ew.saveAs)(r,"".concat(z,".csv"))}},{icon:(0,a.jsx)(b.Z,{}),name:"Ajouter une nouvelle entr\xe9e"},{icon:(0,a.jsx)(e_.Z,{}),name:"Supprimer",onClick:async()=>{await V.mutateAsync({node_id:k},{onSuccess:async()=>{await T(),F(-1)}})}}].map(e=>(0,a.jsx)(x.Z,{icon:e.icon,tooltipTitle:e.name,onClick:e.onClick},e.name))})]})}}}]);
//# sourceMappingURL=22.dc98134d.js.map