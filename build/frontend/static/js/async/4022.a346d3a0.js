"use strict";(self.webpackChunklogin_page=self.webpackChunklogin_page||[]).push([["4022"],{62462:function(e,l,n){n.r(l),n.d(l,{default:()=>eN});var a=n(85893),t=n(83796),i=n(38655),r=n(11419),s=n(93627),o=n(97454),d=n(9599),u=n(84786),c=n(61215),m=n(54757),p=n(2903),v=n(89126),x=n(81035),f=n(77821),h=n(37745),g=n(21967),y=n(9e3),b=n(99469),j=n(93162),C=n(27484),_=n.n(C);let Z=e=>{if(!e)return"";let l=e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").trim();return l.charAt(0).toUpperCase()+l.slice(1)},w=(e,l)=>"".concat(e,"@").concat(l),N=(e,l,n)=>{if((null==n?void 0:n.required)&&(null==l||"string"==typeof l&&""===l.trim()||Array.isArray(l)&&0===l.length))return"Ce champ est requis";if((null==n?void 0:n.min)!==void 0&&"number"==typeof l&&l<n.min)return"La valeur doit \xeatre au moins ".concat(n.min);if((null==n?void 0:n.max)!==void 0&&"number"==typeof l&&l>n.max)return"La valeur doit \xeatre au plus ".concat(n.max);if(null==n?void 0:n.size){let e=Array.isArray(l)||"string"==typeof l?l.length:-1;if(-1!==e){if(void 0!==n.size.min&&e<n.size.min)return"Doit contenir au moins ".concat(n.size.min," caract\xe8res/\xe9l\xe9ments");if(void 0!==n.size.max&&e>n.size.max)return"Doit contenir au plus ".concat(n.size.max," caract\xe8res/\xe9l\xe9ments")}}if((null==n?void 0:n.pattern)&&"string"==typeof l&&!new RegExp(n.pattern).test(l))return"Doit correspondre au mod\xe8le : ".concat(n.pattern);switch(e){case"EmailNode":return"Veuillez entrer une adresse e-mail valide";case"IntNode":return"Veuillez entrer un entier valide";case"PhoneNumberNode":return"Veuillez entrer un num\xe9ro de t\xe9l\xe9phone valide";case"DateNode":return"Veuillez entrer une date valide";default:return"Valeur invalide"}},I=(e,l,n)=>{let a=!0,t="";if((null==n?void 0:n.required)&&(null==l||"string"==typeof l&&""===l.trim()||Array.isArray(l)&&0===l.length))return{isValid:a=!1,message:t="Ce champ est requis"};if(!(null==n?void 0:n.required)&&(null==l||"string"==typeof l&&""===l.trim()||Array.isArray(l)&&0===l.length))return{isValid:!0,message:""};if((null==n?void 0:n.min)!==void 0&&"number"==typeof l&&l<n.min)return{isValid:a=!1,message:t="La valeur doit \xeatre au moins ".concat(n.min)};if((null==n?void 0:n.max)!==void 0&&"number"==typeof l&&l>n.max)return{isValid:a=!1,message:t="La valeur doit \xeatre au plus ".concat(n.max)};if(null==n?void 0:n.size){let e=Array.isArray(l)||"string"==typeof l?l.length:-1;if(-1!==e){if(void 0!==n.size.min&&e<n.size.min)return{isValid:a=!1,message:t="Doit contenir au moins ".concat(n.size.min," caract\xe8res/\xe9l\xe9ments")};if(void 0!==n.size.max&&e>n.size.max)return{isValid:a=!1,message:t="Doit contenir au plus ".concat(n.size.max," caract\xe8res/\xe9l\xe9ments")}}}if((null==n?void 0:n.pattern)&&"string"==typeof l&&!new RegExp(n.pattern).test(l))return{isValid:a=!1,message:t="Doit correspondre au mod\xe8le : ".concat(n.pattern)};switch(e){case"IntNode":(a=/^-?\d+$/.test(l))||(t="Veuillez entrer un entier valide");break;case"DateNode":(a=_()(l).isValid())||(t="Veuillez entrer une date valide")}return{isValid:a,message:t}},k=["StringNode","EmailNode","PhoneNumberNode","IntNode","HistoryChangeNode"],E=["BooleanNode","HideNode"],F=["DateNode"],L=["ImageNode"],D=["FileNode"],A=["ListNode"],S=["ColorNode"],T=[...k,...D,...E,...F,...S];var z=n(7409),K=n(99282),V=n(67178),R=n(67294),q=n(15858),P=n(32153),U=n(11731),W=n(89717),Q=n(6896);let O=R.memo(e=>{let{show:l,selectedField:n,existingNodeList:t,loadingExistingNodes:i,onClose:r,onSelectNode:o}=e,[d,p]=(0,R.useState)(""),v=(0,R.useCallback)(e=>{p(e.target.value)},[]),f=(0,R.useCallback)(()=>{r()},[r]),h=(0,R.useMemo)(()=>t.filter(e=>e.name.toLowerCase().includes(d.toLowerCase())),[t,d]),g=(0,R.useCallback)(e=>{o(e,n)},[o,n]);return(0,a.jsx)(q.Z,{open:l,onClose:f,"aria-labelledby":"existing-node-modal-title","aria-describedby":"existing-node-modal-description",children:(0,a.jsx)(u.Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:{xs:"95vw",sm:"90%",md:"80%"},maxWidth:{xs:"none",sm:600},maxHeight:"90vh",bgcolor:"background.paper",boxShadow:24,outline:"none"},children:(0,a.jsxs)(P.Z,{className:"existing-node-card",sx:{width:"100%",maxHeight:{xs:"85vh",sm:"80vh"},overflow:"auto",borderRadius:{xs:1,sm:2}},children:[(0,a.jsx)(U.Z,{id:"existing-node-modal-title",title:"Select Existing Node",action:(0,a.jsx)(x.Z,{onClick:f,"aria-label":"close",children:(0,a.jsx)(s.Z,{})})}),(0,a.jsxs)(W.Z,{children:[(0,a.jsx)(Q.Z,{fullWidth:!0,variant:"outlined",placeholder:"Search nodes...",value:d,onChange:v,sx:{mb:2}}),(0,a.jsx)(u.Z,{className:"node-list",sx:{maxHeight:"50vh",overflow:"auto"},children:i?(0,a.jsxs)(u.Z,{display:"flex",justifyContent:"center",p:2,children:[(0,a.jsx)(c.Z,{size:24})," ",(0,a.jsx)(m.Z,{sx:{ml:1},children:"Loading nodes..."})]}):(0,a.jsx)(V.Z,{spacing:1,children:h.map(e=>(0,a.jsx)(u.Z,{sx:{p:2,cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},onClick:()=>g(e),children:(0,a.jsx)(m.Z,{fontWeight:"bold",children:e.name})},e.id))})})]})]})})})});var B=n(98848),H=n(80770);let M=e=>{var{value:l,onFocus:n,onChange:t,error:i,helperText:r}=e,s=(0,B._)(e,["value","onFocus","onChange","error","helperText"]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(H.Z,(0,z._)({style:{marginLeft:20},color:l||"",onFocus:n,onChange:e=>{t(e.hex)}},s)),r&&(0,a.jsx)(m.Z,{color:i?"error":"textSecondary",variant:"caption",sx:{mt:1},children:r})]})};var $=n(19298),G=n(92719),X=n(64651),J=n(73892),Y=n(7942),ee=n(24697),el=n(39380),en=n(89276);let ea=e=>{var{fieldKey:l,value:n,onFocus:t,onChange:i}=e,r=(0,B._)(e,["fieldKey","value","onFocus","onChange"]);return(0,a.jsx)(el.Z,{control:(0,a.jsx)(en.Z,(0,z._)({id:l,checked:!!n,onChange:e=>i(e.target.checked)},r)),label:""})};var et=n(85714),ei=n(81266);let er=e=>{let l,n;var{fieldKey:t,value:i,onChange:r,error:s,helperText:o,field:d}=e,u=(0,B._)(e,["fieldKey","value","onChange","error","helperText","field"]);let[c,m]=(0,R.useState)(i?_()(i):null),[p,v]=(0,R.useState)(!1);(0,R.useEffect)(()=>{m(i?_()(i):null)},[i]),(null==d?void 0:d.validations)&&(void 0!==d.validations.min&&(l=_()(d.validations.min)),void 0!==d.validations.max&&(n=_()(d.validations.max)));let x=s||p,f=p&&!o?"Date invalide":o;return(0,a.jsxs)(J.Z,{fullWidth:!0,error:x,children:[(0,a.jsx)(ei.M,(0,K._)((0,z._)({value:c,onChange:(e,l)=>{m(e),v(null!==e&&!e.isValid()),(null===e||(null==e?void 0:e.isValid()))&&r(e)},sx:{width:"100%"},minDate:l,maxDate:n},u),{slotProps:{textField:{size:"small",error:x}}})),f&&(0,a.jsx)(et.Z,{children:f})]})};var es=n(11786);let eo=e=>{var l,n,t,r,s,o,d,u,c,m,p,v,x,f,h,g,y,b,j,C,_,Z,w,N,I,k,{field:E,fieldKey:F,value:L,defaultValue:D,onFocus:A,onChange:S,onFirstChange:T,error:V,helperText:q,multiple:P=!1}=e,U=(0,B._)(e,["field","fieldKey","value","defaultValue","onFocus","onChange","onFirstChange","error","helperText","multiple"]);let W=null==(l=E.listNodeType)?void 0:l.split(".").pop(),O=E.choices||[],H=O.length>0,{data:M,isLoading:$,isError:G}=(0,i.m_)("class_attribute_field",{node_id:E.id});(0,R.useEffect)(()=>{var e,l,n,a,t,i,r,s,o,d,u,c,m;H||$||G||(null==M||null==(i=M.data)||null==(t=i.results)||null==(a=t[0])||null==(n=a.result)||null==(l=n.data)||null==(e=l.attributes)?void 0:e.length)===0||T(null==M||null==(m=M.data)||null==(c=m.results)||null==(u=c[0])||null==(d=u.result)||null==(o=d.data)||null==(s=o.attributes)||null==(r=s.map(e=>({label:e.name.split(". ")[1],value:"STRING"===E.elementType?e.value:e.id})))?void 0:r[0])},[E.elementType,H,$,G,T,null==M||null==(d=M.data)||null==(o=d.results)||null==(s=o[0])||null==(r=s.result)||null==(t=r.data)||null==(n=t.attributes)?void 0:n.length,null==M||null==(x=M.data)||null==(v=x.results)||null==(p=v[0])||null==(m=p.result)||null==(c=m.data)||null==(u=c.attributes)?void 0:u.map]);let{data:X,isLoading:Y,isError:ee}=(0,i.m_)(H?void 0:"list_existing_node",{type:W});return(0,R.useEffect)(()=>{var e,l,n,a,t,i,r,s,o;if(H&&!Y&&!ee&&(null==X||null==(t=X.data)||null==(a=t.results)||null==(n=a[0])||null==(l=n.result)||null==(e=l.data)?void 0:e.length)!==0&&!P)if(D)if(2===D.split("@").length){let e=Number.parseInt(D.split("@")[1]),l=null==X||null==(o=X.data)||null==(s=o.results)||null==(r=s[0])||null==(i=r.result)?void 0:i.data.find(l=>l.id===e);l?T({label:l.name,value:l.id}):T(void 0)}else T({label:D,value:D});else T(void 0)},[H,Y,ee,D,null==X||null==(y=X.data)||null==(g=y.results)||null==(h=g[0])||null==(f=h.result)?void 0:f.data.find,null==X||null==(Z=X.data)||null==(_=Z.results)||null==(C=_[0])||null==(j=C.result)||null==(b=j.data)?void 0:b.length,P,T]),(0,a.jsxs)(J.Z,{fullWidth:!0,error:V,children:[(0,a.jsx)(es.Z,(0,z._)({disablePortal:!0,renderInput:e=>(0,a.jsx)(Q.Z,(0,K._)((0,z._)({},e),{error:V})),options:H?O.map(e=>{var l;return{label:e,value:e,firstLetter:null==(l=e[0])?void 0:l.toUpperCase()}}):(null==X||null==(k=X.data)||null==(I=k.results)||null==(N=I[0])||null==(w=N.result)?void 0:w.data.map(e=>{var l;let n=null==(l=e.name[0])?void 0:l.toUpperCase();return{label:e.name,value:e.id,firstLetter:"France(FR)"===e.name?" ":/[0-9]/.test(n)?"0-9":n}}).sort((e,l)=>e.firstLetter!==l.firstLetter?e.firstLetter.localeCompare(l.firstLetter):e.label.localeCompare(l.label)))||[],groupBy:e=>e.firstLetter,getOptionKey:e=>{var l;return null!=(l=e.value)?l:""},getOptionLabel:e=>{var l;return null!=(l=e.label)?l:""},isOptionEqualToValue:(e,l)=>e.value===l.value,size:"small",id:F,value:L,onChange:(e,l)=>{S(l)},multiple:P},U)),q&&(0,a.jsx)(et.Z,{children:q})]})},ed=e=>{var{field:l,fieldKey:n,value:t,onFocus:i,onChange:r}=e,s=(0,B._)(e,["field","fieldKey","value","onFocus","onChange"]);return(0,a.jsxs)(u.Z,{className:"image-preview-wrapper",sx:{display:"flex",flexDirection:"column",alignItems:"center",mt:2},children:[t&&(0,a.jsx)(u.Z,{component:"img",className:"image-preview",src:"data:".concat(l.mimeType,";base64,").concat(t),alt:l.name,sx:{maxHeight:"150px",width:"auto",objectFit:"contain",mt:1,border:"1px solid #eee"}}),(0,a.jsxs)(f.Z,{variant:"contained",component:"label",sx:{mt:2},children:["Upload New Image",(0,a.jsx)(Q.Z,(0,z._)({type:"file",accept:"image/*",sx:{display:"none"},onClick:i,onChange:async e=>{var l;let n=null==(l=e.target.files)?void 0:l[0];if(!n)return;let a=new FileReader;a.onloadend=async()=>{if("string"==typeof(null==a?void 0:a.result)){var e;r(null==a||null==(e=a.result)?void 0:e.split(",")[1])}},a.readAsDataURL(n)}},s))]})]})};var eu=n(87884);let ec=e=>{let{option:l,fieldId:n}=e,[t,r]=(0,R.useState)(l.value),s=(0,i.uC)("set_value"),o=(0,b.NL)(),d=(0,ee.y1)(async e=>{if(!e)return console.warn("No field provided for saving changes");try{await Y.ZP.promise(s.mutateAsync({id:e.id,value:t},{onSuccess:async()=>{await o.invalidateQueries({queryKey:["infinite","apiData","class_attribute_field",{node_id:Number.parseInt(n)}]}),await o.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:Number.parseInt(n)}]})}}),{loading:"Enregistrement de ".concat(Z(e.name),"..."),success:"Changements enregistr\xe9s pour ".concat(Z(e.name)),error:"Erreur lors de l'enregistrement des changements pour ".concat(Z(e.name))})}catch(e){console.error("Error saving changes:",e)}},500,{maxWait:2e3});return(0,a.jsx)(el.Z,{label:l.name,control:(0,a.jsx)(en.Z,{checked:t||!1,onChange:e=>{r(e.target.checked),d(l)}})})},em=e=>{var l,n,t,r,s,o;let{field:d,error:u,helperText:c}=e,{data:m}=(0,i.m_)("class_attribute_field",{node_id:d.id});return(0,a.jsxs)(J.Z,{fullWidth:!0,error:u,children:[(0,a.jsx)(eu.Z,{row:!0,children:null==m||null==(o=m.data)||null==(s=o.results)||null==(r=s[0])||null==(t=r.result)||null==(n=t.data)||null==(l=n.attributes)?void 0:l.map((e,l)=>(0,a.jsx)(ec,{option:e,fieldId:d.id},l))}),c&&(0,a.jsx)(et.Z,{children:c})]})},ep=e=>{var l,n,t,r,s,o,d,u,c,m,p,v,{field:x,fieldKey:f,value:h,onFocus:g,onChange:y,onFirstChange:b,error:j,helperText:C}=e,_=(0,B._)(e,["field","fieldKey","value","onFocus","onChange","onFirstChange","error","helperText"]);let{data:Z,isLoading:w,isError:N}=(0,i.m_)("class_attribute_field",{node_id:x.id});return(0,R.useEffect)(()=>{var e,l,n,a,t,i,r,s,o,d,u,c;w||N||(null==Z||null==(i=Z.data)||null==(t=i.results)||null==(a=t[0])||null==(n=a.result)||null==(l=n.data)||null==(e=l.attributes)?void 0:e.length)===0||b(null==Z||null==(c=Z.data)||null==(u=c.results)||null==(d=u[0])||null==(o=d.result)||null==(s=o.data)||null==(r=s.attributes)?void 0:r.map(e=>({firstLetter:e.name.split(". ")[1][0],label:e.name.split(". ")[1],value:e.id})))},[w,N,b,null==Z||null==(o=Z.data)||null==(s=o.results)||null==(r=s[0])||null==(t=r.result)||null==(n=t.data)||null==(l=n.attributes)?void 0:l.length,null==Z||null==(v=Z.data)||null==(p=v.results)||null==(m=p[0])||null==(c=m.result)||null==(u=c.data)||null==(d=u.attributes)?void 0:d.map]),(0,a.jsx)(eo,(0,z._)({field:x,fieldKey:f,value:h,onChange:y,onFirstChange:b,error:j,helperText:C,multiple:!0},_))};var ev=n(31382),ex=n(54649),ef=n(45471);n(44493),n(83608);var eh=n(41994);ev.Tu.workerSrc=new URL(n(87663),n.b).toString();let eg=e=>{let{value:l,onChange:n,error:t,helperText:i}=e,[r,s]=(0,R.useState)(l);return(0,R.useEffect)(()=>{if(l){let e=atob(l),n=Array(e.length);for(let l=0;l<e.length;l++)n[l]=e.charCodeAt(l);let a=new Blob([new Uint8Array(n)],{type:"application/pdf"});s(URL.createObjectURL(a))}},[l]),(0,a.jsxs)(u.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},children:[(0,a.jsx)(v.Z,{elevation:2,onClick:e=>{e.stopPropagation(),r&&window.open(r,"_blank","noopener,noreferrer")},sx:{cursor:"pointer",border:"2px solid ".concat(t?"error.main":"transparent"),borderRadius:"8px",width:"180px",height:"254px",overflow:"hidden",position:"relative",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"#f8f8f8",mb:2,transition:"all 0.2s ease-in-out","&:hover":{borderColor:"primary.main",boxShadow:4,transform:"scale(1.02)"}},children:r?(0,a.jsx)(ex.Z,{file:r,loading:(0,a.jsxs)(u.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,a.jsx)(c.Z,{size:40,sx:{mb:1}}),(0,a.jsx)(m.Z,{variant:"caption",color:"text.secondary",children:"Loading PDF..."})]}),error:(0,a.jsxs)(u.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:2},children:[(0,a.jsx)(eh.Z,{color:"error",sx:{fontSize:40,mb:1}}),(0,a.jsx)(m.Z,{variant:"caption",color:"error",children:"Preview not available"})]}),children:(0,a.jsx)(ef.Z,{pageNumber:1,width:180,renderTextLayer:!1,renderAnnotationLayer:!1})}):(0,a.jsxs)(u.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:2},children:[(0,a.jsx)(eh.Z,{color:"disabled",sx:{fontSize:60,mb:1}}),(0,a.jsx)(m.Z,{variant:"caption",color:"text.secondary",align:"center",children:"No PDF selected"})]})}),(0,a.jsxs)(f.Z,{variant:"contained",component:"label",color:"primary",startIcon:(0,a.jsx)(eh.Z,{}),sx:{mt:1},children:["Upload PDF",(0,a.jsx)("input",{type:"file",hidden:!0,accept:"application/pdf",onChange:e=>{let l=e.target.files[0];if(l&&"application/pdf"===l.type){let e=new FileReader;e.onloadend=()=>{if("string"==typeof e.result){var l;n(null==(l=e.result)?void 0:l.split(",")[1])}},e.readAsDataURL(l)}else l&&(alert("Please select a PDF file."),e.target.value=null)}})]}),i&&(0,a.jsx)(m.Z,{color:t?"error":"textSecondary",variant:"caption",sx:{mt:1},children:i})]})};var ey=n(36762),eb=n(54791);let ej=e=>{var l,{field:n,fieldKey:t,value:i,defaultValue:r,onFocus:s,onChange:o,error:d,helperText:u,onFirstChange:c}=e,m=(0,B._)(e,["field","fieldKey","value","defaultValue","onFocus","onChange","error","helperText","onFirstChange"]);return(0,a.jsxs)(J.Z,{fullWidth:!0,error:d,children:[(0,a.jsx)(ey.Z,(0,K._)((0,z._)({row:!0,name:t,value:i||r,onChange:e=>o(e.target.value),onFocus:s},m),{children:null==(l=n.choices)?void 0:l.map((e,l)=>(0,a.jsx)(el.Z,{value:l,control:(0,a.jsx)(eb.Z,{}),label:e},l))})),u&&(0,a.jsx)(et.Z,{children:u})]})},eC=e=>{var{field:l,fieldKey:n,value:t,onFocus:i,onChange:r,error:s,helperText:o}=e,d=(0,B._)(e,["field","fieldKey","value","onFocus","onChange","error","helperText"]);let u={};return(l.validations&&("IntNode"===l.type&&void 0!==l.validations.min&&(u.min=l.validations.min),"IntNode"===l.type&&void 0!==l.validations.max&&(u.max=l.validations.max),l.validations.size&&(void 0!==l.validations.size.min&&(u.minLength=l.validations.size.min),void 0!==l.validations.size.max&&(u.maxLength=l.validations.size.max))),!1===l.canEdit)?(0,a.jsx)(m.Z,{variant:"body1",sx:{py:1},children:t||""}):(0,a.jsx)(Q.Z,(0,z._)({fullWidth:!0,id:n,variant:"outlined",type:(e=>{switch(e){case"EmailNode":return"email";case"PhoneNumberNode":return"tel";case"IntNode":return"number";default:return"text"}})(l.type),value:t||"",onFocus:i,onChange:e=>r(e.target.value),error:s,helperText:o,inputProps:u},d))},e_=R.memo(e=>{let{field:l,fieldKey:n,isExpanded:t,onToggleField:r,onChangingForm:s,parentId:o,defaultValue:d=""}=e,{id:c,name:p,type:v,validations:h,isValid:g}=l,[y,j]=(0,R.useState)(A.includes(v)?"RADIO"===l.listType?l.value:[]:d),[C,_]=(0,R.useState)(!1),[w,z]=(0,R.useState)(""),K=(0,b.NL)(),V=(0,i.uC)("set_value"),q=(0,i.uC)("add_existing_node"),P=(0,i.uC)("remove_from_list"),U=(0,ee.y1)(e=>{let l=I(v,e,h);return _(!l.isValid),z(l.message),l.isValid},300,{maxWait:1e3});(0,R.useEffect)(()=>{U(y)},[y,U]);let W=(0,ee.y1)(async e=>{if(!e)return console.warn("No field provided for saving changes");if(!U(y))return void"Invalid value for ".concat(e.name," (").concat(e.type,"): ").concat(y);try{await Y.ZP.promise(V.mutateAsync({id:e.id,value:y,parentId:o},{onSuccess:async()=>{await K.invalidateQueries({queryKey:["infinite","apiData","class_attribute_field",{node_id:Number.parseInt(o)}]}),await K.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:Number.parseInt(o)}]})}}),{loading:"Enregistrement de ".concat(Z(e.name),"..."),success:"Changements enregistr\xe9s pour ".concat(Z(e.name)),error:"Erreur lors de l'enregistrement des changements pour ".concat(Z(e.name))})}catch(e){console.error("Error saving changes:",e),_(!0),z("Error saving changes: ".concat(e.message))}},500,{maxWait:2e3}),Q=(0,R.useCallback)(async e=>{if(!e)return void j(null);j(e);try{await Y.ZP.promise(V.mutateAsync({id:l.id,value:e},{onSuccess:async()=>{await K.invalidateQueries({queryKey:["infinite","apiData","class_attribute_field",{node_id:Number.parseInt(o)}]}),await K.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:Number.parseInt(o)}]})}}),{loading:"Enregistrement de ".concat(Z(l.name),"..."),success:"Changements enregistr\xe9s pour ".concat(Z(l.name)),error:"Erreur lors de l'enregistrement des changements pour ".concat(Z(l.name))})}catch(e){console.error("Error saving changes:",e),_(!0),z("Error saving changes: ".concat(e.message))}},[l.id,l.name,o,K.invalidateQueries,V.mutateAsync]),O=(0,ee.y1)(async function(e,l){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(!e)return console.warn("No field provided for saving changes");if(!U(l))return void"Invalid value for ".concat(e.name," (").concat(e.type,"): ").concat(l);try{await Y.ZP.promise((n?q:P).mutateAsync({node_id:e.id,id:l},{onSuccess:async()=>{await K.invalidateQueries({queryKey:["infinite","apiData","class_attribute_field",{node_id:Number.parseInt(o)}]}),await K.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:Number.parseInt(o)}]})}}),{loading:"Enregistrement de ".concat(Z(e.name),"..."),success:"Changements enregistr\xe9s pour ".concat(Z(e.name)),error:"Erreur lors de l'enregistrement des changements pour ".concat(Z(e.name))})}catch(e){console.error("Error saving changes:",e),_(!0),z("Error saving changes: ".concat(e.message))}}),B=(0,R.useCallback)(function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let n=I(l.type,e,h);_(!n),n?z(""):z(N(l.type,e,h)),W(l),j(e)},[l,W,h]),H=(0,R.useCallback)(e=>{let n=I(l.type,null==e?void 0:e.value,h);_(!n),n?z(""):z(N(l.type,null==e?void 0:e.value,h)),O(l,null==e?void 0:e.value),j(e)},[l,O,h]),el=(0,R.useCallback)(e=>{j(e)},[]),en=(0,R.useCallback)(e=>{if(!U(e))return;let n=y||[],a=e||[],t=a.filter(e=>!n.some(l=>l.value===e.value));t.length>0&&t.forEach(e=>{O(l,e.value)});let i=n.filter(e=>!a.some(l=>l.value===e.value));i.length>0&&i.forEach(e=>{O(l,e.value,!1)}),j(e)},[l,O,y,U]),et=(0,R.useCallback)(e=>j(e),[]),ei=(0,R.useCallback)(()=>{s(p,c)},[s,p,c]),es=(0,R.useCallback)(()=>{r(n,c)},[r,n,c]);return(0,R.useEffect)(()=>()=>{W.flush()},[W]),(0,a.jsx)(u.Z,{className:"form-field-wrapper",sx:{p:1},children:(0,a.jsxs)(X.Z,{container:!0,className:"form-field",spacing:2,alignItems:"center",children:[(0,a.jsx)(X.Z,{size:{xs:12,sm:4},children:(0,a.jsxs)(J.Z,{component:"fieldset",sx:{display:"flex",flexDirection:"row"},children:[(0,a.jsx)(f.Z,{tabIndex:-1,variant:"text",color:"primary",onClick:ei,title:n,sx:{textAlign:"left",justifyContent:"flex-start"},children:(0,a.jsx)(m.Z,{fontWeight:"medium",color:!1===g?"error":"primary",sx:{fontWeight:!1===g?"bold":"regular"},children:Z(p)})}),!(T.includes(v)||A.includes(v)&&"LIST"!==l.listType)&&(0,a.jsx)(u.Z,{className:"toggle-wrapper",textAlign:"right",children:(0,a.jsx)(x.Z,{onClick:es,size:"small",children:t?(0,a.jsx)($.Z,{}):(0,a.jsx)(G.Z,{})})})]})}),(0,a.jsxs)(X.Z,{size:{xs:12,sm:6},children:[A.includes(v)&&"CHECKBOX"===l.listType&&(0,a.jsx)(em,{field:l,error:C,helperText:C?w:""}),k.includes(v)&&(0,a.jsx)(eC,{field:l,fieldKey:n,value:y,onChange:B,size:"small",error:C,helperText:C?w:""}),F.includes(v)&&(0,a.jsx)(er,{fieldKey:n,field:l,value:y,onChange:B,error:C,helperText:C?w:""}),E.includes(v)&&(0,a.jsx)(ea,{fieldKey:n,value:y,onChange:B}),L.includes(v)&&t&&(0,a.jsx)(ed,{field:l,fieldKey:n,value:y,onChange:B,size:"small"}),A.includes(v)&&"DROPDOWN"===l.listType&&(0,a.jsx)(eo,{field:l,fieldKey:n,value:null!=y?y:null,onChange:H,onFirstChange:el,defaultValue:d,error:C,helperText:C?w:""}),A.includes(v)&&"MULTIDROPDOWN"===l.listType&&(0,a.jsx)(ep,{field:l,fieldKey:n,value:null!=y?y:[],onChange:en,onFirstChange:et,error:C,helperText:C?w:""}),A.includes(v)&&"RADIO"===l.listType&&(0,a.jsx)(ej,{field:l,fieldKey:n,value:y,onChange:B,onFirstChange:el,defaultValue:d,error:C,helperText:C?w:""}),D.includes(v)&&(0,a.jsx)(eg,{value:y,onChange:Q,error:C,helperText:w}),S.includes(v)&&(0,a.jsx)(M,{value:y,onChange:B,error:C,helperText:w})]})]})},n)},(e,l)=>e.fieldKey===l.fieldKey&&e.isExpanded===l.isExpanded&&e.onToggleField===l.onToggleField&&e.defaultValue===l.defaultValue),eZ=e=>{let{parentId:l,fields:n,visited:t=new Set,expandedFields:i,toggleField:r,handleChangingForm:s,rootId:o}=e;return n&&Array.isArray(n)?n.map(e=>{let{id:n,name:d,type:u}=e;if(!d||"graph"===d)return null;let c=w(e.id,e.name);if(t.has(n))return(0,a.jsxs)(m.Z,{color:"error",children:["Circular reference detected for ",d]},"cycle-".concat(n));let p=i[c]||!1;return(0,a.jsxs)(R.Fragment,{children:[(0,a.jsx)(e_,{field:e,fieldKey:c,isExpanded:p,onToggleField:r,onChangingForm:s,defaultValue:e.value,parentId:l}),!(T.includes(u)||A.includes(u)&&"LIST"!==e.listType)&&(0,a.jsx)(ew,{fieldKey:c,field:e,rootId:o,isToggle:p})]},c)}):null},ew=R.memo(e=>{var l;let{field:n,rootId:s,isRoot:o=!1,isToggle:d=!1}=e,{data:c,isLoading:p,fetchNextPage:v,hasNextPage:x,isFetchingNextPage:h,error:g,isError:y}=(0,i.SF)("class_attribute_field",{node_id:"string"==typeof n.id?Number.parseInt(n.id):n.id},{enabled:d||o}),j=(0,t.s0)(),C=(0,b.NL)(),_=(0,i.uC)("jump"),Z=(0,i.uC)("add_node"),N=(0,i.uC)("list_existing_node"),I=(0,i.uC)("add_existing_node"),[k,E]=(0,R.useState)({}),[F,L]=(0,R.useState)(!1),[D,S]=(0,R.useState)([]),[T,q]=(0,R.useState)(null),[P,U]=(0,R.useState)(!1),W=(0,R.useCallback)(async(e,l)=>{try{await _.mutateAsync({node_id:l}),await j("/add-node/form/".concat(l)),window.location.reload()}catch(e){console.error("Error changing form:",e)}},[_,j]),{type:Q,name:B}=n,H=(0,R.useRef)(k);(0,R.useEffect)(()=>{H.current=k},[k]);let M=(0,R.useCallback)(async(e,l)=>{let n=H.current[e];E(l=>(0,K._)((0,z._)({},l),{[e]:!n}))},[]),$=(0,R.useCallback)(async e=>{let l=null==e?void 0:e.id,n=null==e?void 0:e.listNodeType;try{await Z.mutateAsync({BNodeClass:n,node_id:l},{onSuccess:async()=>{await C.invalidateQueries({queryKey:["infinite","apiData","class_attribute_field",{node_id:l}]}),await C.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:l}]})}})}catch(e){console.error("Error adding new node:",e)}},[Z,C]),G=(0,R.useCallback)(async e=>{q(e),L(!0),U(!0);let l=e.listNodeType.split(".").pop();try{var n,a,t,i;let e=await N.mutateAsync({type:l}),r=(null==e||null==(i=e.data)||null==(t=i.results)||null==(a=t[0])||null==(n=a.result)?void 0:n.data)||[];S(r)}catch(e){console.error("Error fetching class attribute field:",e)}finally{U(!1)}},[N]),X=(0,R.useCallback)(async e=>{try{await I.mutateAsync({id:e.id,node_id:n.id},{onSuccess:async()=>{await C.invalidateQueries({queryKey:["infinite","apiData","class_attribute_field",{node_id:n.id}]}),_.mutate({node_id:s})}})}catch(e){console.error("Error adding existing node:",e)}},[I,_,s,n.id,C]),J=(0,R.useCallback)((e,l)=>{X(e),L(!1)},[X]),Y=R.useMemo(()=>(null==c?void 0:c.pages)&&0!==c.pages.length?c.pages.reduce((e,l)=>{try{var n,a,t,i,r;let s=(null==l||null==(r=l.data)||null==(i=r.results)||null==(t=i[0])||null==(a=t.result)||null==(n=a.data)?void 0:n.attributes)||[];return e.push(...s),e}catch(l){return e}},[]):[],[c]);return(0,R.useEffect)(()=>{if(!p&&(null==c?void 0:c.pages)&&Y.length>0){let e={},l={};Y.forEach(n=>{if(n.name&&"null"!==n.value&&void 0!==n.value){let a=w(n.id,n.name);e[a]=n.value,l[a]=n}})}},[p,null==c?void 0:c.pages,Y]),(0,a.jsxs)(R.Fragment,{children:[o?(0,a.jsx)(u.Z,{component:"form",className:"form-fields",onSubmit:e=>e.preventDefault(),sx:{mt:3},children:y?(0,a.jsxs)(m.Z,{color:"error",children:["Error loading fields: ",(null==g?void 0:g.message)||"Unknown error"]}):p&&0===Y.length?(0,a.jsx)(m.Z,{children:"Loading fields..."}):Y.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eZ,{parentId:n.id,fields:Y,expandedFields:k,toggleField:M,handleChangingForm:W,rootId:s}),x&&(0,a.jsx)(u.Z,{sx:{mt:2,textAlign:"center"},children:(0,a.jsx)(f.Z,{variant:"outlined",onClick:()=>v(),disabled:h,size:"small",children:h?"Loading...":"Load More Fields"})})]}):(0,a.jsx)(m.Z,{children:"No fields available."})}):(0,a.jsxs)(u.Z,{className:"nested-fields",sx:{mt:2,pl:2,borderLeft:"1px solid #e0e0e0"},children:[d&&(y?(0,a.jsxs)(m.Z,{variant:"body2",color:"error",children:["Error loading subfields: ",(null==g?void 0:g.message)||"Unknown error"]}):p&&0===Y.length?(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Loading subfields..."}):Y.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eZ,{parentId:n.id,fields:Y,expandedFields:k,toggleField:M,handleChangingForm:W,rootId:s}),x&&(0,a.jsx)(u.Z,{sx:{mt:1,textAlign:"center"},children:(0,a.jsx)(f.Z,{variant:"outlined",size:"small",onClick:()=>v(),disabled:h,sx:{fontSize:"0.75rem"},children:h?"Loading...":"Load More"})})]}):(0,a.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"No subfields available for this."})),A.includes(Q)&&d&&n.canAddNewNode&&(0,a.jsxs)(V.Z,{direction:"row",spacing:2,className:"add-new-node",sx:{mt:2},children:[null!=(l=n.allowCreation)?l:(0,a.jsxs)(f.Z,{variant:"outlined",startIcon:(0,a.jsx)(r.Z,{}),onClick:()=>$(n),children:["Add new ",B]}),(0,a.jsxs)(f.Z,{variant:"outlined",startIcon:(0,a.jsx)(r.Z,{}),onClick:()=>G(n),children:["Add ",B," from Existing Node"]})]})]}),(0,a.jsx)(O,{show:F,selectedField:T,existingNodeList:D,loadingExistingNodes:P,onClose:()=>{L(!1),_.mutate({node_id:s})},onSelectNode:J})]})},(e,l)=>{var n,a;return e.fieldKey===l.fieldKey&&e.rootId===l.rootId&&e.isToggle===l.isToggle&&(null==(n=e.field)?void 0:n.id)===(null==(a=l.field)?void 0:a.id)}),eN=()=>{var e,l,n,C,_,N,I,k,E,F,L;let{rootId:D}=(0,t.UO)(),A=D?parseInt(D):0,S=(0,b.NL)(),T=(0,t.s0)(),{data:z,isLoading:K,error:V,refetch:R}=(0,i.m_)("class_attribute_field",{node_id:A}),q=null==z||null==(N=z.data)||null==(_=N.results)||null==(C=_[0])||null==(n=C.result)||null==(l=n.data)||null==(e=l.currentNode)?void 0:e.name,P=(0,i.uC)("export_csv"),U=(0,i.uC)("remove_node"),W=(0,i.uC)("search_node",{onSuccess:async()=>{var e,l,n,a,t,i,r,s,o,d,u,c;await S.invalidateQueries({queryKey:["apiData","class_attribute_field",{node_id:null==z||null==(i=z.data)||null==(t=i.results)||null==(a=t[0])||null==(n=a.result)||null==(l=n.data)||null==(e=l.attributes)?void 0:e.filter(e=>"results"===e.name)[0].id}]}),await S.invalidateQueries({queryKey:["infinite","apiData","class_attribute_field",{node_id:null==z||null==(c=z.data)||null==(u=c.results)||null==(d=u[0])||null==(o=d.result)||null==(s=o.data)||null==(r=s.attributes)?void 0:r.filter(e=>"results"===e.name)[0].id}]})}});return K?(0,a.jsx)(u.Z,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:(0,a.jsx)(c.Z,{})}):V?(0,a.jsxs)(m.Z,{color:"error",children:["Error loading form fields: ",V.message||"Unknown error"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(p.Z,{className:"form-page",component:v.Z,elevation:3,sx:{p:3,position:"relative"},children:[(0,a.jsx)(x.Z,{className:"close-button",onClick:()=>T(-1),"aria-label":"close",sx:{position:"absolute",top:16,right:16},children:(0,a.jsx)(s.Z,{})}),(0,a.jsxs)(m.Z,{variant:"h4",component:"h1",gutterBottom:!0,children:["Form for: ",Z(q)]}),(0,a.jsx)(ew,{fieldKey:w(A,q),rootId:A,isRoot:!0,field:{id:A}}),(null==z||null==(L=z.data)||null==(F=L.results)||null==(E=F[0])||null==(k=E.result)||null==(I=k.data.currentNode)?void 0:I.type)==="SearchForm"?(0,a.jsx)(f.Z,{variant:"contained",color:"primary",sx:{},onClick:()=>W.mutate({node_id:A,pageSize:1e3}),children:"Rechercher"}):""]}),(0,a.jsx)(h.Z,{ariaLabel:"SpeedDial playground example",sx:{position:"absolute",bottom:16,right:16},hidden:!1,icon:(0,a.jsx)(g.Z,{}),children:[{icon:(0,a.jsx)(d.Z,{}),name:"Exporter",onClick:async()=>{var e,l,n,a;let t=await P.mutateAsync({node_id:A,includeAllFields:!0,maxDepth:4}),i=new Blob([null==t||null==(a=t.data)||null==(n=a.results)||null==(l=n[0])||null==(e=l.result)?void 0:e.data],{type:"text/csv"});(0,j.saveAs)(i,"".concat(q,".csv"))}},{icon:(0,a.jsx)(r.Z,{}),name:"Ajouter une nouvelle entr\xe9e"},{icon:(0,a.jsx)(o.Z,{}),name:"Supprimer",onClick:async()=>{await U.mutateAsync({node_id:A,delete:!1},{onSuccess:async e=>{await R();var l,n,a,t,i,r,s,o,d=null==e||null==(t=e.data)||null==(a=t.results)||null==(n=a[0])||null==(l=n.result)?void 0:l.data,u="Those node will be affected : \n";for(let l=0;l<(null==e||null==(o=e.data)||null==(s=o.results)||null==(r=s[0])||null==(i=r.result)?void 0:i.data.length);l++)u+="".concat(d[l].id,"@").concat(d[l].class,", ");u+="\n\nAre you sure you want to delete this node ?",window.confirm(u)&&await U.mutateAsync({node_id:A,delete:!0},{onSuccess:async()=>{await R(),T(-1)}})}})}}].map(e=>(0,a.jsx)(y.Z,{icon:e.icon,tooltipTitle:e.name,onClick:e.onClick},e.name))})]})}}}]);
//# sourceMappingURL=4022.a346d3a0.js.map