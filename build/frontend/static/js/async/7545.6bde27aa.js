"use strict";(self.webpackChunklogin_page=self.webpackChunklogin_page||[]).push([["7545"],{68596:function(e,t,r){r.r(t),r.d(t,{default:()=>B});var a=r(85893),l=r(9142),i=r(59157),n=r(62822),s=r(22826),o=r(22561),c=r(38655),d=r(77012),x=r(89425),u=r(45631),m=r(80372),h=r(11419),p=r(90271),g=r(32153),b=r(54757),f=r(11731),v=r(13400),w=r(60488),j=r(81035),y=r(89717),Z=r(33991),C=r(39467),k=r(47044),S=r(77821),T=r(89126),I=r(8523),O=r(73876),W=r(89276),_=r(19410),z=r(39380),V=r(73716),D=r(74542),R=r(7547),P=r(61215),L=r(16970),N=r(30925),M=r(81839),E=r(67294),J=r(9673);let A=(0,E.memo)(e=>{let{view:t,onExpand:r,handleViewToggle:n}=e,s=(0,p.Z)(),o=(0,E.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),n(t.name)},[n,t.name]),c=(0,E.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),r(t)},[r,t]),u="technical"===t.type;return(0,a.jsx)(i.ZP,{fallback:(0,a.jsx)(g.Z,{sx:{aspectRatio:"1",border:"1px solid ".concat(s.palette.error.main),borderRadius:2,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.light"},role:"alert",children:(0,a.jsx)(b.Z,{color:"error",variant:"body2",children:"Erreur de chargement de la vue"})}),children:(0,a.jsxs)(g.Z,{sx:{aspectRatio:"1",border:"1px solid ".concat(s.palette.divider),borderRadius:2,display:"flex",flexDirection:"column",bgcolor:u?"warning.light":"background.paper",transition:"transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:s.shadows[4]},"&:focus-within":{outline:"2px solid ".concat(s.palette.primary.main),outlineOffset:"2px"}},"aria-label":"Vue ".concat(t.pretty_name,": ").concat(t.description),children:[(0,a.jsx)(f.Z,{sx:{height:{xs:50,sm:60},bgcolor:u?"warning.main":"grey.100",borderBottom:"1px solid ".concat(s.palette.divider),p:{xs:.5,sm:1},position:"relative","& .MuiCardHeader-content":{overflow:"hidden"}},title:(0,a.jsx)(b.Z,{variant:"caption",sx:{color:u?"warning.contrastText":"text.secondary",fontWeight:500,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",lineHeight:1.2},children:t.pretty_name}),subheader:(0,a.jsx)(b.Z,{variant:"caption",sx:{color:u?"warning.contrastText":"text.disabled",fontSize:"0.7rem",display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:t.description}),action:(0,a.jsxs)(v.Z,{direction:"row",spacing:.5,children:[(0,a.jsx)(w.Z,{title:"Agrandir la vue",children:(0,a.jsx)(j.Z,{onClick:c,size:"small","aria-label":"Agrandir la vue ".concat(t.pretty_name),sx:{color:u?"warning.contrastText":"action.active","&:hover":{bgcolor:"action.hover"},"&:focus":{outline:"2px solid ".concat(s.palette.primary.main),outlineOffset:"1px"}},children:(0,a.jsx)(d.Z,{fontSize:"small"})})}),(0,a.jsx)(w.Z,{title:"Fermer la vue",children:(0,a.jsx)(j.Z,{onClick:o,size:"small","aria-label":"Fermer la vue ".concat(t.pretty_name),sx:{color:u?"warning.contrastText":"action.active","&:hover":{bgcolor:"action.hover"},"&:focus":{outline:"2px solid ".concat(s.palette.primary.main),outlineOffset:"1px"}},children:(0,a.jsx)(x.Z,{fontSize:"small"})})})]})}),(0,a.jsx)(y.Z,{sx:{p:{xs:1.5,sm:2},height:"calc(100% - 60px)",display:"flex",flexDirection:"column",overflow:"hidden",bgcolor:u?"warning.light":"background.paper","&:last-child":{pb:{xs:1.5,sm:2}}},children:(0,a.jsx)(Z.Z,{sx:{flex:1,overflow:"auto",color:"text.primary",scrollbarWidth:"thin",scrollbarColor:"".concat(s.palette.primary.main," ").concat(s.palette.grey[200]),"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-thumb":{bgcolor:"primary.main",borderRadius:"3px"},"&::-webkit-scrollbar-track":{bgcolor:"grey.200"},wordBreak:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap",maxWidth:"100%",fontSize:{xs:"0.75rem",sm:"0.875rem"}},"aria-label":"Contenu de la vue ".concat(t.pretty_name),children:t.error?(0,a.jsx)(C.Z,{severity:"error",variant:"outlined",sx:{mt:1},children:(0,a.jsx)(b.Z,{variant:"body2",children:t.error})}):(0,a.jsx)(i.ZP,{fallback:(0,a.jsx)(C.Z,{severity:"error",variant:"outlined",sx:{mt:1},children:(0,a.jsx)(b.Z,{variant:"body2",children:"Erreur de chargement de la vue"})}),children:(0,a.jsx)(E.Suspense,{fallback:(0,a.jsxs)(v.Z,{spacing:1,sx:{mt:1},children:[(0,a.jsx)(k.Z,{variant:"text",width:"80%"}),(0,a.jsx)(k.Z,{variant:"text",width:"60%"}),(0,a.jsx)(k.Z,{variant:"rectangular",height:60})]}),children:(0,a.jsx)(l.G,{viewId:t.name.replaceAll(" ","_"),sx:{bgcolor:u?"warning.light":"background.paper",width:"100%"}})})})})})]})})}),F=(0,E.memo)(e=>{let{views:t,selectedViews:r,columns:l,onViewToggle:n,onViewExpand:s}=e,o=t.filter(e=>r.includes(e.name)),c=(0,E.useDeferredValue)(o),d=Math.min(l,c.length);return(0,a.jsx)(i.ZP,{fallback:(0,a.jsx)(Z.Z,{sx:{textAlign:"center",p:3,color:"error.main"},children:(0,a.jsx)(b.Z,{children:"Error loading view grid"})}),children:(0,a.jsx)(Z.Z,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(".concat(Math.min(l,2),", 1fr)"),md:"repeat(".concat(d,", 1fr)")},gap:{xs:2,sm:4},opacity:1,transition:"opacity 0.2s ease-in-out"},children:c.map(e=>(0,a.jsx)(A,{view:e,onExpand:s,handleViewToggle:n},e.name))})})}),B=(0,E.memo)(()=>{let e=(0,p.Z)(),t=(0,J.s0)(),[r,d]=(0,E.useState)(Date.now());new Date("1920-01-01").getTime(),Date.now();let{data:g,isLoading:f,error:v}=(0,c.m_)("endpoints?only_applicable&type=byransha.web.View",{},{staleTime:3e4,gcTime:3e5,refetchOnWindowFocus:!1,refetchOnReconnect:!0}),{isLoading:w,withLoading:y}=(0,n.$C)(),[C,k]=(0,o.av)(null,{transitionUpdates:!0}),[A,B]=(0,E.useState)(!1);(0,s.Z)("Accueil"),(0,c.uC)("node_info");let[H,U,G]=(0,o.av)(2,{transitionUpdates:!0,deferUpdates:!1}),[q,Y]=(0,E.useState)(()=>JSON.parse(localStorage.getItem("autoColumns")||"true")),[$,K,Q]=(0,o.av)(null,{transitionUpdates:!0}),[X,ee]=(0,E.useState)([]),[et,er]=(0,E.useState)(()=>JSON.parse(localStorage.getItem("showTechnicalViews")||"false")),[ea]=(0,o.av)("",{transitionUpdates:!0,debounceMs:300}),[el]=(0,o.m9)(ea,300),ei=(0,c.uC)("jump"),[en,es]=(0,E.useState)([]),[eo]=(0,E.useTransition)(),ec=(0,E.useCallback)(()=>{let e=window.innerWidth;return e<900?1:e<1600?2:e<2100?3:4},[]),ed=(0,E.useDeferredValue)(en),ex=(0,E.useDeferredValue)(X),eu=(0,E.useMemo)(()=>{let e=et?ed:ed.filter(e=>"technical"!==e.type);return el.trim()&&(e=e.filter(e=>{var t,r;return(null==(t=e.pretty_name)?void 0:t.toLowerCase().includes(el.toLowerCase()))||(null==(r=e.description)?void 0:r.toLowerCase().includes(el.toLowerCase()))})),e},[ed,et,el]);E.useEffect(()=>{var e,t,r,a;(null==g||null==(a=g.data)||null==(r=a.results)||null==(t=r[0])||null==(e=t.result)?void 0:e.data)&&(0,E.startTransition)(()=>{let e,t=g.data.results[0].result.data,r=et?t:t.filter(e=>"technical"!==e.type),a=JSON.parse(localStorage.getItem("viewOrder"))||[],l=r;a.length>0&&(l=[...r].sort((e,t)=>{let r=a.indexOf(e.endpoint),l=a.indexOf(t.endpoint);return(-1===r?1/0:r)-(-1===l?1/0:l)})),es(l);let i=JSON.parse(localStorage.getItem("selectedViewsSaved"));e=i&&0!==i.length?i.filter(e=>r.some(t=>t.name===e)):r.map(e=>e.name),localStorage.setItem("selectedViewsSaved",JSON.stringify(e)),ee(e)})},[g,et]),E.useEffect(()=>{let e=()=>{q&&(0,E.startTransition)(()=>{U(ec())})};return q&&(window.addEventListener("resize",e),e()),()=>window.removeEventListener("resize",e)},[ec,U,q]);let em=(0,E.useCallback)(e=>{K(e.currentTarget)},[K]),eh=(0,E.useCallback)(()=>{K(null)},[K]),ep=(0,E.useCallback)(e=>{(0,E.startTransition)(()=>{ee(t=>{let r=t.includes(e)?t.filter(t=>t!==e):[...t,e];return localStorage.setItem("selectedViewsSaved",JSON.stringify(r)),0===en.filter(e=>"technical"===e.type).filter(e=>r.includes(e.name)).length&&et&&(er(!1),localStorage.setItem("showTechnicalViews",JSON.stringify(!1))),r})})},[en,et]),eg=(0,E.useCallback)(()=>{(0,E.startTransition)(()=>{er(e=>{var t,r,a,l,i;let n=!e;localStorage.setItem("showTechnicalViews",JSON.stringify(n));let s=((null==g||null==(i=g.data)||null==(l=i.results)||null==(a=l[0])||null==(r=a.result)||null==(t=r.data)?void 0:t.filter(e=>"technical"===e.type))||[]).map(e=>e.name);return ee(e=>{let t;return t=n?[...new Set([...e,...s])]:e.filter(e=>!s.includes(e)),localStorage.setItem("selectedViewsSaved",JSON.stringify(t)),t}),n})})},[g]),eb=(0,E.useCallback)(()=>{let e=!q;Y(e),localStorage.setItem("autoColumns",JSON.stringify(e)),e&&(0,E.startTransition)(()=>{U(ec())})},[q,ec,U]),ef=(0,E.useCallback)(e=>{y(async()=>{if(e.name.endsWith("class_attribute_field")){var r,a;await ei.mutateAsync({node:null==g||null==(r=g.data)?void 0:r.node_id}),t("/add-node/form/".concat(null==g||null==(a=g.data)?void 0:a.node_id))}else t("/home/".concat(e.name)),e.name})},[y,ei,g,t]),ev=(0,E.useCallback)(()=>{B(!1),setTimeout(()=>k(null),200)},[k]),ew=(0,E.useCallback)(()=>{(0,E.startTransition)(()=>{U(e=>Math.min(e+1,eu.length))})},[eu.length,U]),ej=(0,E.useCallback)(()=>{(0,E.startTransition)(()=>{U(e=>Math.max(e-1,1))})},[U]);if(f)return(0,a.jsx)(i.ZP,{children:(0,a.jsx)(n.vj.Page,{})});if(v||!g||!g.data||!g.data.results)return(0,a.jsx)(i.ZP,{children:(0,a.jsx)(Z.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",padding:3,bgcolor:"#2e3b55"},children:(0,a.jsxs)(Z.Z,{sx:{bgcolor:"#fff3e0",p:3,borderRadius:2,color:"#ef6c00",textAlign:"center",maxWidth:"500px"},children:[(0,a.jsx)(b.Z,{variant:"h6",gutterBottom:!0,children:"Failed to Load Data"}),(0,a.jsx)(b.Z,{variant:"body2",sx:{mb:2},children:(null==v?void 0:v.message)||"Data is null or unavailable."}),(0,a.jsx)(S.Z,{variant:"contained",onClick:()=>window.location.reload(),sx:{mt:1},children:"Retry"})]})})});let ey=w||G||Q||eo;return(0,a.jsx)(i.ZP,{children:(0,a.jsxs)(Z.Z,{sx:{padding:{xs:"8px",sm:"16px",md:"40px"},maxWidth:"100%",margin:"0 auto",bgcolor:"#2e3b55",minHeight:"100vh",zIndex:1,opacity:ey?.8:1,transition:"opacity 0.2s ease-in-out"},className:"home-page",children:[(0,a.jsx)(T.Z,{elevation:2,sx:{p:{xs:2,sm:3},mb:{xs:2,sm:4},borderRadius:3,bgcolor:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:(0,a.jsxs)(Z.Z,{sx:{display:"flex",flexDirection:{xs:"column",lg:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",lg:"center"},gap:{xs:2,sm:3}},children:[(0,a.jsxs)(Z.Z,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:{xs:2,sm:3},alignItems:{xs:"flex-start",sm:"center"},flex:1},children:[(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(S.Z,{variant:"outlined",startIcon:(0,a.jsx)(u.Z,{}),onClick:em,disabled:ey,sx:{borderColor:"#90caf9",color:"#1976d2",textTransform:"none",borderRadius:2,"&:hover":{borderColor:"#42a5f5",bgcolor:"rgba(25, 118, 210, 0.04)"}},children:"S\xe9lection des vues"}),(0,a.jsx)(I.Z,{anchorEl:$,open:!!$,onClose:eh,PaperProps:{sx:{maxHeight:{xs:300,sm:400},maxWidth:{xs:"90vw",sm:350},mt:1,borderRadius:2,boxShadow:e.shadows[8]}},children:eu.map(e=>(0,a.jsx)(O.Z,{sx:{py:1,px:2,borderRadius:1,mx:1,mb:.5,"&:hover":{bgcolor:"primary.50"}},children:(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",width:"100%"},onClick:()=>ep(e.name),children:[(0,a.jsx)(W.Z,{checked:ex.includes(e.name),sx:{color:"#90caf9","&.Mui-checked":{color:"#90caf9"}}}),(0,a.jsx)(_.Z,{primary:e.pretty_name,secondary:"technical"===e.type?"Technique":""})]})},e.name))})]}),(0,a.jsx)(z.Z,{control:(0,a.jsx)(V.Z,{checked:et,onChange:eg,disabled:ey,color:"primary"}),label:"Vues techniques",sx:{"& .MuiFormControlLabel-label":{fontSize:{xs:"0.875rem",sm:"1rem"},color:"text.primary"}}}),(0,a.jsx)(D.Z,{orientation:"vertical",flexItem:!0,sx:{display:{xs:"none",sm:"block"}}}),(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,a.jsx)(z.Z,{control:(0,a.jsx)(V.Z,{checked:q,onChange:eb,color:"primary"}),label:"Auto colonnes",sx:{"& .MuiFormControlLabel-label":{fontSize:{xs:"0.875rem",sm:"1rem"},color:"text.primary",fontWeight:q?600:400},px:2,py:1,borderRadius:2,bgcolor:q?"primary.50":"grey.50",transition:"all 0.2s ease-in-out"}}),!q&&(0,a.jsxs)(R.Z,{variant:"outlined",size:"small",disabled:ey,sx:{"& .MuiButton-root":{minWidth:{xs:32,sm:40},fontSize:{xs:"0.75rem",sm:"0.875rem"},borderColor:"#90caf9",color:"#1976d2","&:hover":{borderColor:"#42a5f5",bgcolor:"rgba(25, 118, 210, 0.04)"}}},children:[(0,a.jsx)(S.Z,{onClick:ej,disabled:1===H,children:(0,a.jsx)(m.Z,{fontSize:"small"})}),(0,a.jsx)(S.Z,{disabled:!0,sx:{cursor:"default"},children:H}),(0,a.jsx)(S.Z,{onClick:ew,disabled:H===eu.length,children:(0,a.jsx)(h.Z,{fontSize:"small"})})]})]})]}),(0,a.jsx)(S.Z,{variant:"contained",startIcon:(0,a.jsx)(h.Z,{}),onClick:()=>t("/add-node"),disabled:ey,sx:{px:3,py:1.5,borderRadius:2,textTransform:"none",fontSize:"1rem",fontWeight:600,boxShadow:e.shadows[3],"&:hover":{boxShadow:e.shadows[6],transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"},children:"Nouveau nœud"})]})}),(0,a.jsx)(E.Suspense,{fallback:(0,a.jsx)(n.vj.Grid,{columns:H,count:6}),children:(0,a.jsx)(F,{views:eu,selectedViews:ex,columns:H,onViewToggle:ep,onViewExpand:ef})}),ey&&(0,a.jsx)(Z.Z,{sx:{position:"fixed",bottom:24,right:24,zIndex:1400},children:(0,a.jsx)(P.Z,{})}),(0,a.jsxs)(L.Z,{open:A,onClose:ev,maxWidth:"lg",fullWidth:!0,"aria-labelledby":"expanded-view-title",PaperProps:{sx:{height:"90vh",maxHeight:"90vh",borderRadius:3,overflow:"hidden"}},TransitionProps:{timeout:300},children:[(0,a.jsxs)(N.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #e0e0e0",bgcolor:"primary.50",py:2},children:[(0,a.jsx)(b.Z,{variant:"h6",sx:{fontWeight:600},children:(null==C?void 0:C.pretty_name)||"Vue agrandie"}),(0,a.jsx)(j.Z,{onClick:ev,"aria-label":"Fermer la vue agrandie",sx:{"&:hover":{bgcolor:"primary.100"}},children:(0,a.jsx)(x.Z,{})})]}),(0,a.jsx)(M.Z,{sx:{p:0,height:"100%"},children:C&&A&&(0,a.jsx)(E.Suspense,{fallback:(0,a.jsxs)(Z.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%",gap:2},children:[(0,a.jsx)(P.Z,{size:48}),(0,a.jsxs)(b.Z,{variant:"body1",color:"text.secondary",children:["Chargement de ",C.pretty_name,"..."]})]}),children:(0,a.jsx)(l.G,{viewId:C.name,sx:{height:"100%",overflow:"auto"}})})})]})]})})})}}]);
//# sourceMappingURL=7545.6bde27aa.js.map