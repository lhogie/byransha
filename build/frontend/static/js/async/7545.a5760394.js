"use strict";(self.webpackChunklogin_page=self.webpackChunklogin_page||[]).push([["7545"],{68596:function(e,t,a){a.r(t),a.d(t,{default:()=>q});var r=a(85893),l=a(9142),i=a(59157),n=a(62822),s=a(22826),o=a(22561),c=a(38655),d=a(77012),x=a(89425),u=a(45631),m=a(80372),h=a(11419),p=a(90271),g=a(32153),b=a(54757),f=a(11731),v=a(67178),j=a(60488),w=a(81035),y=a(89717),Z=a(84786),C=a(39467),k=a(47044),S=a(77821),T=a(89126),I=a(8523),O=a(73876),W=a(89276),z=a(19410),V=a(39380),_=a(73716),D=a(74542),N=a(60261),P=a(6350),R=a(61215),L=a(16970),M=a(30925),E=a(81839),J=a(81266),F=a(27484),A=a.n(F),B=a(67294),H=a(83796);let U=(0,B.memo)(e=>{let{view:t,onExpand:a,handleViewToggle:n}=e,s=(0,p.Z)(),o=(0,B.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),n(t.name)},[n,t.name]),c=(0,B.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),a(t)},[a,t]),u="technical"===t.type;return(0,r.jsx)(i.ZP,{fallback:(0,r.jsx)(g.Z,{sx:{aspectRatio:"1",border:"1px solid ".concat(s.palette.error.main),borderRadius:2,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.light"},role:"alert",children:(0,r.jsx)(b.Z,{color:"error",variant:"body2",children:"Erreur de chargement de la vue"})}),children:(0,r.jsxs)(g.Z,{sx:{aspectRatio:"1",border:"1px solid ".concat(s.palette.divider),borderRadius:2,display:"flex",flexDirection:"column",bgcolor:u?"warning.light":"background.paper",transition:"transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:s.shadows[4]},"&:focus-within":{outline:"2px solid ".concat(s.palette.primary.main),outlineOffset:"2px"}},"aria-label":"Vue ".concat(t.pretty_name,": ").concat(t.description),children:[(0,r.jsx)(f.Z,{sx:{height:{xs:50,sm:60},bgcolor:u?"warning.main":"grey.100",borderBottom:"1px solid ".concat(s.palette.divider),p:{xs:.5,sm:1},position:"relative","& .MuiCardHeader-content":{overflow:"hidden"}},title:(0,r.jsx)(b.Z,{variant:"caption",sx:{color:u?"warning.contrastText":"text.secondary",fontWeight:500,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",lineHeight:1.2},children:t.pretty_name}),subheader:(0,r.jsx)(b.Z,{variant:"caption",sx:{color:u?"warning.contrastText":"text.disabled",fontSize:"0.7rem",display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:t.description}),action:(0,r.jsxs)(v.Z,{direction:"row",spacing:.5,children:[(0,r.jsx)(j.Z,{title:"Agrandir la vue",children:(0,r.jsx)(w.Z,{onClick:c,size:"small","aria-label":"Agrandir la vue ".concat(t.pretty_name),sx:{color:u?"warning.contrastText":"action.active","&:hover":{bgcolor:"action.hover"},"&:focus":{outline:"2px solid ".concat(s.palette.primary.main),outlineOffset:"1px"}},children:(0,r.jsx)(d.Z,{fontSize:"small"})})}),(0,r.jsx)(j.Z,{title:"Fermer la vue",children:(0,r.jsx)(w.Z,{onClick:o,size:"small","aria-label":"Fermer la vue ".concat(t.pretty_name),sx:{color:u?"warning.contrastText":"action.active","&:hover":{bgcolor:"action.hover"},"&:focus":{outline:"2px solid ".concat(s.palette.primary.main),outlineOffset:"1px"}},children:(0,r.jsx)(x.Z,{fontSize:"small"})})})]})}),(0,r.jsx)(y.Z,{sx:{p:{xs:1.5,sm:2},height:"calc(100% - 60px)",display:"flex",flexDirection:"column",overflow:"hidden",bgcolor:u?"warning.light":"background.paper","&:last-child":{pb:{xs:1.5,sm:2}}},children:(0,r.jsx)(Z.Z,{sx:{flex:1,overflow:"auto",color:"text.primary",scrollbarWidth:"thin",scrollbarColor:"".concat(s.palette.primary.main," ").concat(s.palette.grey[200]),"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-thumb":{bgcolor:"primary.main",borderRadius:"3px"},"&::-webkit-scrollbar-track":{bgcolor:"grey.200"},wordBreak:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap",maxWidth:"100%",fontSize:{xs:"0.75rem",sm:"0.875rem"}},"aria-label":"Contenu de la vue ".concat(t.pretty_name),children:t.error?(0,r.jsx)(C.Z,{severity:"error",variant:"outlined",sx:{mt:1},children:(0,r.jsx)(b.Z,{variant:"body2",children:t.error})}):(0,r.jsx)(i.ZP,{fallback:(0,r.jsx)(C.Z,{severity:"error",variant:"outlined",sx:{mt:1},children:(0,r.jsx)(b.Z,{variant:"body2",children:"Erreur de chargement de la vue"})}),children:(0,r.jsx)(B.Suspense,{fallback:(0,r.jsxs)(v.Z,{spacing:1,sx:{mt:1},children:[(0,r.jsx)(k.Z,{variant:"text",width:"80%"}),(0,r.jsx)(k.Z,{variant:"text",width:"60%"}),(0,r.jsx)(k.Z,{variant:"rectangular",height:60})]}),children:(0,r.jsx)(l.G,{viewId:t.name.replaceAll(" ","_"),sx:{bgcolor:u?"warning.light":"background.paper",width:"100%"}})})})})})]})})}),G=(0,B.memo)(e=>{let{views:t,selectedViews:a,columns:l,onViewToggle:n,onViewExpand:s}=e,o=t.filter(e=>a.includes(e.name)),c=(0,B.useDeferredValue)(o),d=Math.min(l,c.length);return(0,r.jsx)(i.ZP,{fallback:(0,r.jsx)(Z.Z,{sx:{textAlign:"center",p:3,color:"error.main"},children:(0,r.jsx)(b.Z,{children:"Error loading view grid"})}),children:(0,r.jsx)(Z.Z,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(".concat(Math.min(l,2),", 1fr)"),md:"repeat(".concat(d,", 1fr)")},gap:{xs:2,sm:4},opacity:1,transition:"opacity 0.2s ease-in-out"},children:c.map(e=>(0,r.jsx)(U,{view:e,onExpand:s,handleViewToggle:n},e.name))})})}),q=(0,B.memo)(()=>{let e=(0,p.Z)(),t=(0,H.s0)(),[a,d]=(0,B.useState)(Date.now()),g=new Date("1920-01-01").getTime(),f=Date.now(),{data:v,isLoading:j,error:y}=(0,c.m_)("endpoints?only_applicable&type=byransha.web.View",{},{staleTime:3e4,gcTime:3e5,refetchOnWindowFocus:!1,refetchOnReconnect:!0}),{isLoading:C,withLoading:k}=(0,n.$C)(),[F,U]=(0,o.av)(null,{transitionUpdates:!0}),[q,Y]=(0,B.useState)(!1);(0,s.Z)("Accueil");let[$,K,Q]=(0,o.av)(2,{transitionUpdates:!0,deferUpdates:!1}),[X,ee]=(0,B.useState)(()=>JSON.parse(localStorage.getItem("autoColumns")||"true")),[et,ea,er]=(0,o.av)(null,{transitionUpdates:!0}),[el,ei]=(0,B.useState)([]),[en,es]=(0,B.useState)(()=>JSON.parse(localStorage.getItem("showTechnicalViews")||"false")),[eo]=(0,o.av)("",{transitionUpdates:!0,debounceMs:300}),[ec]=(0,o.m9)(eo,300),ed=(0,c.uC)("jump"),[ex,eu]=(0,B.useState)([]),[em]=(0,B.useTransition)(),eh=(0,B.useCallback)(()=>{let e=window.innerWidth;return e<900?1:e<1600?2:e<2100?3:4},[]),ep=(0,B.useDeferredValue)(ex),eg=(0,B.useDeferredValue)(el),eb=(0,B.useMemo)(()=>{let e=en?ep:ep.filter(e=>"technical"!==e.type);return ec.trim()&&(e=e.filter(e=>{var t,a;return(null==(t=e.pretty_name)?void 0:t.toLowerCase().includes(ec.toLowerCase()))||(null==(a=e.description)?void 0:a.toLowerCase().includes(ec.toLowerCase()))})),e},[ep,en,ec]);B.useEffect(()=>{var e,t,a,r;(null==v||null==(r=v.data)||null==(a=r.results)||null==(t=a[0])||null==(e=t.result)?void 0:e.data)&&(0,B.startTransition)(()=>{let e,t=v.data.results[0].result.data,a=en?t:t.filter(e=>"technical"!==e.type),r=JSON.parse(localStorage.getItem("viewOrder"))||[],l=a;r.length>0&&(l=[...a].sort((e,t)=>{let a=r.indexOf(e.endpoint),l=r.indexOf(t.endpoint);return(-1===a?1/0:a)-(-1===l?1/0:l)})),eu(l);let i=JSON.parse(localStorage.getItem("selectedViewsSaved"));e=i&&0!==i.length?i.filter(e=>a.some(t=>t.name===e)):a.map(e=>e.name),localStorage.setItem("selectedViewsSaved",JSON.stringify(e)),ei(e)})},[v,en]),B.useEffect(()=>{let e=()=>{X&&(0,B.startTransition)(()=>{K(eh())})};return X&&(window.addEventListener("resize",e),e()),()=>window.removeEventListener("resize",e)},[eh,K,X]);let ef=(0,B.useCallback)(e=>{ea(e.currentTarget)},[ea]),ev=(0,B.useCallback)(()=>{ea(null)},[ea]),ej=(0,B.useCallback)(e=>{(0,B.startTransition)(()=>{ei(t=>{let a=t.includes(e)?t.filter(t=>t!==e):[...t,e];return localStorage.setItem("selectedViewsSaved",JSON.stringify(a)),0===ex.filter(e=>"technical"===e.type).filter(e=>a.includes(e.name)).length&&en&&(es(!1),localStorage.setItem("showTechnicalViews",JSON.stringify(!1))),a})})},[ex,en]),ew=(0,B.useCallback)(()=>{(0,B.startTransition)(()=>{es(e=>{var t,a,r,l,i;let n=!e;localStorage.setItem("showTechnicalViews",JSON.stringify(n));let s=((null==v||null==(i=v.data)||null==(l=i.results)||null==(r=l[0])||null==(a=r.result)||null==(t=a.data)?void 0:t.filter(e=>"technical"===e.type))||[]).map(e=>e.name);return ei(e=>{let t;return t=n?[...new Set([...e,...s])]:e.filter(e=>!s.includes(e)),localStorage.setItem("selectedViewsSaved",JSON.stringify(t)),t}),n})})},[v]),ey=(0,B.useCallback)(()=>{let e=!X;ee(e),localStorage.setItem("autoColumns",JSON.stringify(e)),e&&(0,B.startTransition)(()=>{K(eh())})},[X,eh,K]),eZ=(0,B.useCallback)(e=>{k(async()=>{if(e.name.endsWith("class_attribute_field")){var a,r;await ed.mutateAsync({node:null==v||null==(a=v.data)?void 0:a.node_id}),t("/add-node/form/".concat(null==v||null==(r=v.data)?void 0:r.node_id))}else t("/home/".concat(e.name)),e.name})},[k,ed,v,t]),eC=(0,B.useCallback)(()=>{Y(!1),setTimeout(()=>U(null),200)},[U]),ek=(0,B.useCallback)(()=>{(0,B.startTransition)(()=>{K(e=>Math.min(e+1,eb.length))})},[eb.length,K]),eS=(0,B.useCallback)(()=>{(0,B.startTransition)(()=>{K(e=>Math.max(e-1,1))})},[K]);if(j)return(0,r.jsx)(i.ZP,{children:(0,r.jsx)(n.vj.Page,{})});if(y||!v||!v.data||!v.data.results)return(0,r.jsx)(i.ZP,{children:(0,r.jsx)(Z.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",padding:3,bgcolor:"#2e3b55"},children:(0,r.jsxs)(Z.Z,{sx:{bgcolor:"#fff3e0",p:3,borderRadius:2,color:"#ef6c00",textAlign:"center",maxWidth:"500px"},children:[(0,r.jsx)(b.Z,{variant:"h6",gutterBottom:!0,children:"Failed to Load Data"}),(0,r.jsx)(b.Z,{variant:"body2",sx:{mb:2},children:(null==y?void 0:y.message)||"Data is null or unavailable."}),(0,r.jsx)(S.Z,{variant:"contained",onClick:()=>window.location.reload(),sx:{mt:1},children:"Retry"})]})})});let eT=C||Q||er||em;return(0,r.jsx)(i.ZP,{children:(0,r.jsxs)(Z.Z,{sx:{padding:{xs:"8px",sm:"16px",md:"40px"},maxWidth:"100%",margin:"0 auto",bgcolor:"#2e3b55",minHeight:"100vh",zIndex:1,opacity:eT?.8:1,transition:"opacity 0.2s ease-in-out"},className:"home-page",children:[(0,r.jsx)(T.Z,{elevation:2,sx:{p:{xs:2,sm:3},mb:{xs:2,sm:4},borderRadius:3,bgcolor:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:(0,r.jsxs)(Z.Z,{sx:{display:"flex",flexDirection:{xs:"column",lg:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",lg:"center"},gap:{xs:2,sm:3}},children:[(0,r.jsxs)(Z.Z,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:{xs:2,sm:3},alignItems:{xs:"flex-start",sm:"center"},flex:1},children:[(0,r.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(S.Z,{variant:"outlined",startIcon:(0,r.jsx)(u.Z,{}),onClick:ef,disabled:eT,sx:{borderColor:"#90caf9",color:"#1976d2",textTransform:"none",borderRadius:2,"&:hover":{borderColor:"#42a5f5",bgcolor:"rgba(25, 118, 210, 0.04)"}},children:"S\xe9lection des vues"}),(0,r.jsx)(I.Z,{anchorEl:et,open:!!et,onClose:ev,PaperProps:{sx:{maxHeight:{xs:300,sm:400},maxWidth:{xs:"90vw",sm:350},mt:1,borderRadius:2,boxShadow:e.shadows[8]}},children:eb.map(e=>(0,r.jsx)(O.Z,{sx:{py:1,px:2,borderRadius:1,mx:1,mb:.5,"&:hover":{bgcolor:"primary.50"}},children:(0,r.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",width:"100%"},onClick:()=>ej(e.name),children:[(0,r.jsx)(W.Z,{checked:eg.includes(e.name),sx:{color:"#90caf9","&.Mui-checked":{color:"#90caf9"}}}),(0,r.jsx)(z.Z,{primary:e.pretty_name,secondary:"technical"===e.type?"Technique":""})]})},e.name))})]}),(0,r.jsx)(V.Z,{control:(0,r.jsx)(_.Z,{checked:en,onChange:ew,disabled:eT,color:"primary"}),label:"Vues techniques",sx:{"& .MuiFormControlLabel-label":{fontSize:{xs:"0.875rem",sm:"1rem"},color:"text.primary"}}}),(0,r.jsx)(D.Z,{orientation:"vertical",flexItem:!0,sx:{display:{xs:"none",sm:"block"}}}),(0,r.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(V.Z,{control:(0,r.jsx)(_.Z,{checked:X,onChange:ey,color:"primary"}),label:"Auto colonnes",sx:{"& .MuiFormControlLabel-label":{fontSize:{xs:"0.875rem",sm:"1rem"},color:"text.primary",fontWeight:X?600:400},px:2,py:1,borderRadius:2,bgcolor:X?"primary.50":"grey.50",transition:"all 0.2s ease-in-out"}}),!X&&(0,r.jsxs)(N.Z,{variant:"outlined",size:"small",disabled:eT,sx:{"& .MuiButton-root":{minWidth:{xs:32,sm:40},fontSize:{xs:"0.75rem",sm:"0.875rem"},borderColor:"#90caf9",color:"#1976d2","&:hover":{borderColor:"#42a5f5",bgcolor:"rgba(25, 118, 210, 0.04)"}}},children:[(0,r.jsx)(S.Z,{onClick:eS,disabled:1===$,children:(0,r.jsx)(m.Z,{fontSize:"small"})}),(0,r.jsx)(S.Z,{disabled:!0,sx:{cursor:"default"},children:$}),(0,r.jsx)(S.Z,{onClick:ek,disabled:$===eb.length,children:(0,r.jsx)(h.Z,{fontSize:"small"})})]})]})]}),(0,r.jsxs)(Z.Z,{sx:{minWidth:220},children:[(0,r.jsx)(J.M,{disableFuture:!0,value:A()(a),onChange:e=>{let t=A()(e).valueOf();Number.isNaN(t)||d(t)},sx:{mb:1}}),(0,r.jsx)(P.ZP,{size:"small",min:g,max:f,step:864e5,value:a,onChange:(e,t)=>{d(t)},valueLabelDisplay:"off"})]}),(0,r.jsx)(S.Z,{variant:"contained",startIcon:(0,r.jsx)(h.Z,{}),onClick:()=>t("/add-node"),disabled:eT,sx:{px:3,py:1.5,borderRadius:2,textTransform:"none",fontSize:"1rem",fontWeight:600,boxShadow:e.shadows[3],"&:hover":{boxShadow:e.shadows[6],transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"},children:"Nouveau nœud"})]})}),(0,r.jsx)(B.Suspense,{fallback:(0,r.jsx)(n.vj.Grid,{columns:$,count:6}),children:(0,r.jsx)(G,{views:eb,selectedViews:eg,columns:$,onViewToggle:ej,onViewExpand:eZ})}),eT&&(0,r.jsx)(Z.Z,{sx:{position:"fixed",bottom:24,right:24,zIndex:1400},children:(0,r.jsx)(R.Z,{})}),(0,r.jsxs)(L.Z,{open:q,onClose:eC,maxWidth:"lg",fullWidth:!0,"aria-labelledby":"expanded-view-title",PaperProps:{sx:{height:"90vh",maxHeight:"90vh",borderRadius:3,overflow:"hidden"}},TransitionProps:{timeout:300},children:[(0,r.jsxs)(M.Z,{id:"expanded-view-title",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #e0e0e0",bgcolor:"primary.50",py:2},children:[(0,r.jsx)(b.Z,{variant:"h6",sx:{fontWeight:600},children:(null==F?void 0:F.pretty_name)||"Vue agrandie"}),(0,r.jsx)(w.Z,{onClick:eC,"aria-label":"Fermer la vue agrandie",sx:{"&:hover":{bgcolor:"primary.100"}},children:(0,r.jsx)(x.Z,{})})]}),(0,r.jsx)(E.Z,{sx:{p:0,height:"100%"},children:F&&q&&(0,r.jsx)(B.Suspense,{fallback:(0,r.jsxs)(Z.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%",gap:2},children:[(0,r.jsx)(R.Z,{size:48}),(0,r.jsxs)(b.Z,{variant:"body1",color:"text.secondary",children:["Chargement de ",F.pretty_name,"..."]})]}),children:(0,r.jsx)(l.G,{viewId:F.name,sx:{height:"100%",overflow:"auto"}})})})]})]})})})}}]);
//# sourceMappingURL=7545.a5760394.js.map